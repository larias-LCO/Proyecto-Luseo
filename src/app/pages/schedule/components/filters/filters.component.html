<div class="schedule-filters">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title mb-3">
        <i class="bi bi-funnel"></i>
        Filters
      </h5>
      <div class="row">
        <!-- Filtro por proyecto (dropdown para controlar dirección) -->
        <div class="col-md-4 mb-3">
          <label class="form-label">Projects</label>
          <div class="dropdown" [class.show]="projectDropdownOpen">
            <button class="form-select dropdown-toggle text-start" type="button" (click)="toggleProjectDropdown($event)" [attr.aria-expanded]="projectDropdownOpen">
              <span *ngIf="filters.projectIds.length === 0">Select project...</span>
              <span *ngIf="filters.projectIds.length === 1">
                {{ getProjectLabel(filters.projectIds[0]) }}
              </span>
              <span *ngIf="filters.projectIds.length > 1">{{ filters.projectIds.length }} selected</span>
            </button>
            <ul class="dropdown-menu" [class.show]="projectDropdownOpen">
              <li *ngFor="let project of projects">
                <a class="dropdown-item" (click)="toggleProject(project.id); $event.preventDefault(); $event.stopPropagation();">
                  {{ project.projectCode }} - {{ project.name }}
                </a>
              </li>
            </ul>
          </div>
          <div class="selected-filters mt-2" *ngIf="filters.projectIds.length > 0">
            <span class="badge bg-primary me-1" *ngFor="let projectId of filters.projectIds">
              {{ getProjectLabel(projectId) }}
              <i class="bi bi-x-circle ms-1" (click)="toggleProject(projectId)" style="cursor: pointer;"></i>
            </span>
          </div>
        </div>

        <!-- Filtro por categoría -->
        <div class="col-md-4 mb-3">
          <label class="form-label">Categories</label>
          <div class="dropdown categories-dropdown" [class.show]="categoryDropdownOpen">
            <button class="form-select dropdown-toggle text-start" type="button" (click)="toggleCategoryDropdown($event)" [attr.aria-expanded]="categoryDropdownOpen">
              <span *ngIf="filters.categoryIds.length === 0">Select category...</span>
              <span *ngIf="filters.categoryIds.length === 1">{{ getCategoryLabel(filters.categoryIds[0]) }}</span>
              <span *ngIf="filters.categoryIds.length > 1">{{ filters.categoryIds.length }} selected</span>
            </button>
            <ul class="dropdown-menu" [class.show]="categoryDropdownOpen">
              <li *ngFor="let category of categories">
                <a class="dropdown-item" (click)="toggleCategory(category.id); $event.preventDefault(); $event.stopPropagation();">
                  {{ category.name }}
                </a>
              </li>
            </ul>
          </div>
          <div class="selected-filters mt-2" *ngIf="filters.categoryIds.length > 0">
            <span class="badge bg-info me-1" *ngFor="let categoryId of filters.categoryIds">
              {{ getCategoryLabel(categoryId) }}
              <i class="bi bi-x-circle ms-1" (click)="toggleCategory(categoryId)" style="cursor: pointer;"></i>
            </span>
          </div>
        </div>

        <!-- Filtro por creador (solo personas que tienen tareas) -->
        <div class="col-md-4 mb-3">
          <label class="form-label">Created By</label>
          <div class="dropdown creators-dropdown" [class.show]="creatorsDropdownOpen">
            <button class="form-select dropdown-toggle text-start" type="button" (click)="creatorsDropdownOpen = !creatorsDropdownOpen; $event.stopPropagation()" [attr.aria-expanded]="creatorsDropdownOpen">
              <span *ngIf="!filters.createdByEmployeeIds || filters.createdByEmployeeIds.length === 0">All creators...</span>
              <span *ngIf="filters.createdByEmployeeIds && filters.createdByEmployeeIds.length === 1">{{ getCreatorLabel(filters.createdByEmployeeIds[0]) }}</span>
              <span *ngIf="filters.createdByEmployeeIds && filters.createdByEmployeeIds.length > 1">{{ filters.createdByEmployeeIds.length }} selected</span>
            </button>
            <ul class="dropdown-menu" [class.show]="creatorsDropdownOpen">
              <li *ngFor="let c of creators">
                <a class="dropdown-item" (click)="toggleCreator(c.id); $event.preventDefault(); $event.stopPropagation();">
                  {{ c.name }}
                </a>
              </li>
            </ul>
          </div>
          <div class="selected-filters mt-2" *ngIf="filters.createdByEmployeeIds && filters.createdByEmployeeIds.length > 0">
            <span class="badge bg-secondary me-1" *ngFor="let cid of filters.createdByEmployeeIds">
              {{ getCreatorLabel(cid) }}
              <i class="bi bi-x-circle ms-1" (click)="toggleCreator(cid)" style="cursor: pointer;"></i>
            </span>
          </div>
        </div>

        <!-- Actions -->
        <div class="col-md-4 mb-3 actions-col">
          <label class="form-label">Actions</label>
          <div class="mt-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="myProjectsOnly" [checked]="filters.myProjectsOnly" (change)="toggleMyProjectsOnly()">
              <label class="form-check-label" for="myProjectsOnly">Only my projects</label>
            </div>
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" id="createdByMe" [checked]="filters.createdByMe" (change)="toggleCreatedByMe()">
              <label class="form-check-label" for="createdByMe">Created by me</label>
            </div>
            <div class="mt-2">
              <button class="btn btn-outline-primary me-2" (click)="clearFilters()">
                <i class="bi bi-x-circle"></i>
                Clear Filters
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
