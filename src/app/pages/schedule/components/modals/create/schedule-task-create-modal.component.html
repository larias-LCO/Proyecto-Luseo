<div class="modal-backdrop">
  <div class="modal-card">
    <header class="modal-header">
      <h3>Create Task</h3>
      <button class="close-btn" (click)="onClose()"><app-x-icon></app-x-icon></button>
    </header>

    <form [formGroup]="form" class="modal-body">
      <div class="form-group">
        <label>Name</label>
        <input formControlName="name" />
        <div class="field-error" *ngIf="form.get('name')?.touched && form.get('name')?.errors">
          <div *ngIf="form.get('name')?.errors?.['required']">Name is required</div>
        </div>
      </div>

      <div class="form-group">
        <label>Issued Date</label>
        <input type="date" formControlName="issuedDate" />
        <div class="field-error" *ngIf="form.get('issuedDate')?.touched && form.get('issuedDate')?.errors">
          <div *ngIf="form.get('issuedDate')?.errors?.['required']">Issued date is required</div>
        </div>
      </div>

      <ng-container *ngIf="showEndDate()">
        <div class="form-group">
          <label>End Date</label>
          <input type="date" formControlName="endDate" />
          <div class="field-error" *ngIf="form.get('endDate')?.touched && form.get('endDate')?.errors">
            <div *ngIf="form.get('endDate')?.errors?.['required']">End date is required for this category</div>
          </div>
        </div>
      </ng-container>

      <div class="form-group">
        <label>Project</label>
        <select formControlName="projectId">
          <option value="">--</option>
          <option *ngFor="let p of projects" [value]="p.id">{{ p.projectCode || p.code || '' }}{{ (p.projectCode || p.code) ? ' - ' : '' }}{{ p.name }}</option>
        </select>
      </div>

      <ng-container *ngIf="phases.length">
        <div class="form-group">
          <label>Project Phase</label>
          <select formControlName="projectPhaseId">
            <option value="">--</option>
            <option *ngFor="let ph of phases" [value]="ph.id">{{ ph.name }}</option>
          </select>
        </div>
      </ng-container>

      <div class="form-group">
        <label>Category</label>
        <select formControlName="taskCategoryId">
          <option value="">--</option>
          <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
        </select>
        <div class="field-error" *ngIf="form.get('taskCategoryId')?.touched && form.get('taskCategoryId')?.errors">
          <div *ngIf="form.get('taskCategoryId')?.errors?.['required']">Category is required</div>
        </div>
      </div>

      <div class="form-group">
        <label>Status</label>
        <select formControlName="status">
          <option *ngFor="let s of (statusList || [])" [value]="s">{{ s }}</option>
        </select>
      </div>

      <div class="form-group full-row">
        <label>Description</label>
        <textarea formControlName="description"></textarea>
      </div>

      <div class="form-group">
        <label>BIM Date</label>
        <input type="date" formControlName="bimDate" />
      </div>

      <div class="form-group full-row">
        <label>Description BIM</label>
        <textarea formControlName="descriptionBim"></textarea>
      </div>

      <div class="form-group full-row">
        <label>Description Electrical</label>
        <textarea formControlName="descriptionElectrical"></textarea>
      </div>

      <div class="form-group full-row">
        <label>Description Mechanical</label>
        <textarea formControlName="descriptionMechanical"></textarea>
      </div>

      <div class="form-group full-row">
        <label>Description Plumbing</label>
        <textarea formControlName="descriptionPlumbing"></textarea>
      </div>

      <div class="form-group full-row">
        <label>Description Structural</label>
        <textarea formControlName="descriptionStructural"></textarea>
      </div>

    </form>

    <footer class="modal-footer">
      <button (click)="onClose()">Cancel</button>
      <button [disabled]="isSaving" (click)="onCreate()">Create</button>
    </footer>
  </div>
</div>
