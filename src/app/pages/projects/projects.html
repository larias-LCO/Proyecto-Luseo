<!-- Page header and submenu -->
<app-header></app-header>
<app-submenu></app-submenu>

<!-- Hidden helper so static analyzers detect dynamic '.kv' usage  -->
<div id="__util_classes" aria-hidden="true" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
  <span class="chip"></span>
  <div class="kv"><span>Key</span></div>
  <button class="btn btn-danger" type="button">X</button>
  <div class="grid-2"><div class="pair"><div class="val"></div></div></div>
  <button class="btn-xs"></button>
  <div class="scroll"><div class="row-mini"></div></div> 
</div> 
<div class="project-container">
    <h1 >Projects</h1>

  <!-- <div class="row" style="margin-bottom:12px;">
  <button id="openCreate" class="btn btn-primary" type="button" [style.display]="isAdminOrOwner ? '' : 'none'">New project</button> -->
    <!-- <span class="muted">Create and manage projects with backend-paged filters.</span> -->
  <!-- </div> -->

  <!-- FILTER SEARCH -->
    <div class="filter-search">
        <label for="f_q">Search</label>
        <input id="f_q" placeholder="Name, code or client" [(ngModel)]="searchText" (ngModelChange)="onSearchChange($event)" (keyup.enter)="applySearchFromUI()" />
      </div>
 


      <!-- //filtros horizontales -->
       <!-- FILTRO Office -->
<div class="filters-container">
  <!-- Fila 1 -->
  <div class="filter-item">
    <label>Office</label>
    <select [(ngModel)]="selectedOffice" (change)="applySearchFromUI()">
      <option value="">All</option>
      <option *ngFor="let office of offices" [value]="office.id">{{ office.name }}</option>
    </select>
  </div>

      <!-- FILTRO CLIENTE -->
      <div class="filter-item">
        <label>Client</label>
        <select [(ngModel)]="selectedClient" (change)="applySearchFromUI()">
          <option value="">All</option>
          <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
        </select>
      </div>

      <!-- FILTRO SOFTWARE -->
    <div class="filter-item">
        <label>Software</label>
      <select [(ngModel)]="selectedSoftware" (change)="applySearchFromUI()">
    <option value="">All</option>
    <option *ngFor="let s of software" [value]="s.id">{{ s.name }}</option>
  </select>
</div>

<!-- PROJECT MANAGER FILTER -->
  <div class="filter-item">
  <label>Project Manager</label>
  <select [(ngModel)]="selectedManager" (change)="applySearchFromUI()">
    <option value="">All</option>
    <option *ngFor="let m of managerOptions" [value]="m.id">{{ m.name }}</option>
  </select>
  </div>

      <!-- DEPARTAMENT FILTER -->
      <div class="filter-item">
          <label>Department</label>
        <select [(ngModel)]="selectedDepartment" (change)="applySearchFromUI()">
    <option value="">All</option>
    <option *ngFor="let d of departments" [value]="d.id">{{ d.name }}</option>
  </select>
  </div>



  <!-- ROW 2 FILTER STATUS-->
  <div class="filter-item">
     <label>Status</label>
       <select [(ngModel)]="selectedStatus" (change)="applySearchFromUI()">
          <option value="">All</option>
         <option *ngFor="let s of statusList" [value]="s.value">{{ s.label }}</option>

        </select>
      </div>

      <!-- FILTRO TYPE -->
      <div class="filter-item">
         <label>Type</label>
        <select [(ngModel)]="selectedType" (change)="applySearchFromUI()">

          <option value="">All</option>
           <option *ngFor="let t of enums.type" [value]="t">{{ displayEnum(t) }}</option>
        </select>
      </div>

      <!-- FILTRO SCOPE -->
      <div class="filter-item">
        <label>Scope</label>
        <select [(ngModel)]="selectedScope" (change)="applySearchFromUI()">
          <option value="">All</option>
            <option *ngFor="let s of enums.scope" [value]="s">{{ displayEnum(s) }}</option>
        </select>
      </div>

      <!-- FILTRO PAGE SIZE -->
      <!-- Page Size + Botones en una sola fila -->
  <div class="filter-actions-group">
    <div class="filter-item">
      <label>Page Size</label>
      <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
      </select>
    </div>
    
 <div class="filters-actions">
      <button id="openCreate" class="btn-create" type="button" [style.display]="isAdminOrOwner ? '' : 'none'" (click)="openCreateModal()">Create New Project</button>
      <button id="refresh" class="btn btn-clear-filters" type="button" (click)="clearFilters()">Clean filters</button>
    </div>
  </div>
</div>

    <!-- Create Project Modal Component (solo visible si isCreateOpen) -->
    <app-create-project *ngIf="isCreateOpen" (close)="closeCreateModal()"></app-create-project>




    
    <!-- New pager location: below filters and above the project list -->
     <div class="pager-wrap">
  <div id="pager" class="pager">
    <button id="pg_prev" class="btn-pager" type="button" (click)="prevPage()">
      ‹ Prev
    </button>

    <span id="pg_info" class="pager-info">{{ renderPagerInfo() }}</span>

    <button id="sort_toggle" class="btn-pager sort-btn" type="button" title="Sort by project code" (click)="toggleSort()">
      Code ↑
    </button>

    <button id="pg_next" class="btn-pager" type="button" (click)="nextPage()">
      Next ›
    </button>
  </div>
</div>

   


    <div class="table-wrap">
      <table class="project-table" aria-label="Projects list">
        <thead>
          <tr>
            <th>Project Code</th>
            <th>Project Name</th>
            <th>Client</th>
            <th>Type</th>
            <th>Office</th>
            <th>Scope</th>
            <th>Software</th>
            <th>Estado</th>
            <th>PMs</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="projects.length === 0">
            <td class="muted" colspan="9">No results</td>
          </tr>
  <tr *ngFor="let p of projects; trackBy: trackByProject"
    (click)="openProjectDetails(p)"
    class="clickable-row">

    <td>{{ p.projectCode || '-' }}</td>
    <td>{{ p.name || '-' }}</td>
    <td>{{ p.clientName || '-' }}</td>
    <td>{{ displayEnum(p.projectType) || '-' }}</td>
    <td>{{ p.officeName || '-' }}</td>
    <td>{{ displayEnum(p.scope) || '-' }}</td>
    <td>{{ p.softwareName || '-' }}</td>
    <td>
      <span class="status-pill {{ statusToClass(p.status) }}">{{ p.status || '-' }}</span>
    </td>
    <td>{{ p.pmNames || '-' }}</td>

    
        </tbody>
      </table>
    </div>


<app-project-details
  *ngIf="selectedProjectId || selectedProject"
  [projectId]="selectedProjectId ?? undefined"
  [project]="selectedProject"
  [roles]="auth.getRoles()"
  (close)="handleProjectDetailsClose($event)">
</app-project-details>





