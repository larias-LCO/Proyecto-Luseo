<!-- Page header and submenu -->
<app-header></app-header>
<app-submenu class="menu" [class.open]="isMenuOpen"></app-submenu>

  

 <app-menu-filters-projects
   [offices]="offices"
   [clients]="clients"
   [software]="software"
   [departments]="departments"
  [managerOptions]="managerOptionsAll"
   [enums]="enums"
   [pageSize]="pageSize"
   (filtersChange)="onFiltersUpdated($event)"
   (clear)="clearFilters()"
   (toggleSubmenu)="isMenuOpen = !isMenuOpen"></app-menu-filters-projects>
 
<!-- Hidden helper so static analyzers detect dynamic '.kv' usage  -->
<div id="__util_classes" aria-hidden="true" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
  <span class="chip"></span>
  <div class="kv"><span>Key</span></div>
  <button class="btn btn-danger" type="button">X</button>
  <div class="grid-2"><div class="pair"><div class="val"></div></div></div>
  <button class="btn-xs"></button>
  <div class="scroll"><div class="row-mini"></div></div> 
</div> 
<div class="project-container">
    <h1 >Projects</h1>

    <div *ngIf="isAdminOrOwner">
    <p class="texto-descriptivo">
 This page allows administrators and owners to comprehensively manage system projects. From here, they can create, edit, and delete projects, define key information, organize their status, and keep data up to date.
<br>
The interface is designed to facilitate efficient project control and administration, ensuring proper management and tracking. üõ†Ô∏è</p>
</div>

<div *ngIf="isUserOnly">
  <p class="texto-descriptivo">
    This page is intended for view-only users. It allows you to view information on available projects and use search filters to quickly find projects of interest.
Users cannot make modifications, ensuring data integrity while maintaining a clear and organized browsing experience.üëÄ
  </p>

</div>

  <!-- <div class="row" style="margin-bottom:12px;">
  <button id="openCreate" class="btn btn-primary" type="button" [style.display]="isAdminOrOwner ? '' : 'none'">New project</button> -->
    <!-- <span class="muted">Create and manage projects with backend-paged filters.</span> -->
  <!-- </div> -->

  <!-- Filters moved to component above. Keep page-size and action buttons here -->
  <div class="filter-actions-group">
    <!-- <div class="filter-item">
      <label>Page Size</label>
      <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
      </select>
    </div> -->
    
<!-- ================================================================================== -->
    <!-- BOTON DE CREAR PROYECTO MOVIDO AL COMPONENTE DE FILTROS -->
     <!-- ======================================================================================== -->
    <div class="filters-actions">
      <div class="tooltip">
        <!-- <button id="openCreate" class="btn-create" type="button"  [style.display]="isAdminOrOwner ? '' : 'none'" (click)="openCreateModal()">
          Create New Project
        </button>
        <span class="tooltip-text">Create a new project to organize, plan and track your tasks.</span> -->


        <!-- From Uiverse.io by andrew-demchenk0 --> 
        <button id="openCreate" type="button" class="button" [style.display]="isAdminOrOwner ? '' : 'none'" (click)="openCreateModal()">
        <span class="button__text"> Create New Project</span>
        <span class="button__icon"><svg xmlns="http://www.w3.org/2000/svg"  width="24" viewBox="0 0 24 24" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor" height="24" fill="none" class="svg"><line y2="19" y1="5" x2="12" x1="12"></line><line y2="12" y1="12" x2="19" x1="5"></line></svg></span>
          </button>
          <span class="tooltip-text">Create a new project to organize, plan and track your tasks.</span>
      </div>
    </div>







  </div>

    <!-- Create Project Modal Component (solo visible si isCreateOpen) -->
    <app-create-project *ngIf="isCreateOpen" (close)="closeCreateModal()"></app-create-project>




    
    <!-- New pager location: below filters and above the project list -->
     <div class="pager-wrap">
  <div id="pager" class="pager">
    <button id="pg_prev" class="btn-pager" type="button" (click)="prevPage()">
      ‚Äπ Prev
    </button>

    <span id="pg_info" class="pager-info">{{ renderPagerInfo() }}</span>

    <button id="sort_toggle" class="btn-pager sort-btn" type="button" title="Sort by project code" (click)="toggleSort()">
      Code ‚Üë
    </button>

    <button id="pg_next" class="btn-pager" type="button" (click)="nextPage()">
      Next ‚Ä∫
    </button>
  </div>
</div>

   


   <div class="projects-grid">

  <div
    class="project-card"
    *ngFor="let p of projects; trackBy: trackByProject"
    (click)="openProjectDetails(p)"
  >

    <!-- Header -->
    <div class="card-header">
      <span class="project-code">{{ p.projectCode || '-' }}</span>
      <span class="status-pill {{ statusToClass(p.status) }}">
        {{ p.status || '-' }}
      </span>
    </div>

    <!-- Title -->
    <h3 class="project-name">{{ p.name || '-' }}</h3>

    <!-- Info grid -->
    <div class="card-info">
      <div>
        <span class="label">Client</span>
        <span class="value">{{ p.clientName || '-' }}</span>
      </div>

      <div>
        <span class="label">Type</span>
        <span class="value">{{ displayEnum(p.projectType) || '-' }}</span>
      </div>

      <div>
        <span class="label">Office</span>
        <span class="value">{{ p.officeName || '-' }}</span>
      </div>

      <div>
        <span class="label">Scope</span>
        <span class="value">{{ displayEnum(p.scope) || '-' }}</span>
      </div>

      <div>
        <span class="label">Software</span>
        <span class="value">{{ p.softwareName || '-' }}</span>
      </div>
    </div>

    <!-- Footer -->
    <div class="card-footer">
      <span class="label">PMs</span>
      <span class="value">{{ p.pmNames || '-' }}</span>
    </div>

  </div>

  <div *ngIf="projects.length === 0" class="empty-state">
    No results
  </div>

</div>



<app-project-details
  *ngIf="selectedProjectId || selectedProject"
  [projectId]="selectedProjectId ?? undefined"
  [project]="selectedProject"
  [roles]="auth.getRoles()"
  (close)="handleProjectDetailsClose($event)">
</app-project-details>





