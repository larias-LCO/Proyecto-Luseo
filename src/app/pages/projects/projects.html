<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Projects | Create and list</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

</head>
<body> -->
<!-- <header>
  <div id="user-info">Loading user...</div>
  <button id="logoutButton" type="button">Sign out</button>
</header> -->

<!-- Hidden helper so static analyzers detect dynamic '.kv' usage -->
<div id="__util_classes" aria-hidden="true" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">
  <span class="chip"></span>
  <div class="kv"><span>Key</span></div>
  <button class="btn btn-danger" type="button">X</button>
  <div class="grid-2"><div class="pair"><div class="val"></div></div></div>
  <button class="btn-xs"></button>
  <div class="scroll"><div class="row-mini"></div></div>
</div>
<div class="page">
  <h1 class="section-title">Projects</h1>

  <!-- Top buttons -->
  <div class="row" style="margin-bottom:12px;">
  <button id="openCreate" class="btn btn-primary" type="button" [style.display]="isAdminOrOwner ? '' : 'none'">New project</button>
    <span class="muted">Create and manage projects with backend-paged filters.</span>
  </div>

  <div class="card">
    <div class="toolbar">
      <div class="field">
        <label for="f_q">Search</label>
        <input id="f_q" placeholder="Name, code or client" />
      </div>

      <div class="field">
        <label for="f_office">Office</label>
        <select [(ngModel)]="selectedOffice">
          <option value="">All</option>
          <option *ngFor="let office of offices" [value]="office.id">{{ office.name }}</option>
        </select>
      </div>

      <div class="field">
        <label>Client</label>
        <select [(ngModel)]="selectedClient">
          <option value="">All</option>
          <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
        </select>
      </div>

    <div class="field">
      <label>Software</label>
  <select [(ngModel)]="selectedSoftware">
    <option value="">All</option>
    <option *ngFor="let s of software" [value]="s.id">{{ s.name }}</option>
  </select>
</div>

      <div class="field">
        <label>Project Manager</label>
  <select [(ngModel)]="selectedManager">
    <option value="">All</option>
    <option *ngFor="let m of projectManagers" [value]="m.id">
      {{ m.name }} · {{ m.jobPositionName }} {{ m.departmentName ? '· ' + m.departmentName : '' }}
    </option>
  </select>
      </div>


      <div class="field">
         <label>Department</label>
  <select [(ngModel)]="selectedDepartment">
    <option value="">All</option>
    <option *ngFor="let d of departments" [value]="d.id">{{ d.name }}</option>
  </select>


      <div class="field">
        <label for="f_status">Status</label>
        <select [(ngModel)]="selectedStatus">
          <option value="">All</option>
         <option *ngFor="let s of statusList" [value]="s.value">{{ s.label }}</option>

        </select>
      </div>


      <div class="field">
        <label for="f_type">Type</label>
        <select [(ngModel)]="selectedType">
          <option value="">All</option>
           <option *ngFor="let t of enums.type" [value]="t">{{ displayEnum(t) }}</option>
        </select>
      </div>

      <div class="field">
        <label for="f_scope">Scope</label>
        <select [(ngModel)]="selectedScope">
          <option value="">All</option>
            <option *ngFor="let s of enums.scope" [value]="s">{{ displayEnum(s) }}</option>
        </select>
      </div>


      <div class="field">
        <label for="f_size">Page size</label>
        <select [(ngModel)]="pageSize">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="30">30</option>
        </select>
      </div>
      <div class="field"><label>&nbsp;</label><button id="f_apply" class="btn btn-secondary" type="button">Search</button></div>
      <div class="field"><label>&nbsp;</label><button id="refresh" class="btn" type="button">Clear</button></div>
      <div class="spacer" style="flex:1 1 auto"></div>
    </div>

    <!-- New pager location: below filters and above the project list -->
    <div class="pager-wrap">
      <div id="pager" class="pager">
        <button id="pg_prev" class="btn" type="button">Prev</button>
        <span id="pg_info" class="muted">-</span>
        <!-- Sort toggle lives with pager controls to reflect view behavior -->
        <button id="sort_toggle" class="btn" type="button" title="Sort by project code">Code ↑</button>
        <button id="pg_next" class="btn" type="button">Next</button>
      </div>
    </div>

    <ul id="list" class="list"></ul>
  </div>
</div>

<!-- Project detail modal -->
<div id="projectModal" class="modal-backdrop">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-header">
      <div id="modalTitle" style="font-weight:600">Project details</div>
      <button id="modalClose" class="btn btn-secondary" type="button">Close</button>
    </div>
    <div id="modalBody" class="modal-body"></div>
  </div>
</div>

<!-- Create project modal -->
<div id="createModal" class="modal-backdrop">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="createTitle">
    <div class="modal-header">
      <div id="createTitle" style="font-weight:600">Create project</div>
      <button id="createClose" class="btn btn-secondary" type="button">Close</button>
    </div>
    <div id="createBody" class="modal-body">
      <div class="grid">
        <div><label for="p_code">Code</label><input id="p_code" placeholder="PRJ-001" /></div>
        <div><label for="p_name">Name</label><input id="p_name" placeholder="Project name" /></div>
        <div><label for="p_area">Area</label><input id="p_area" type="number" step="0.01" placeholder="0.00" /></div>
        <div><label for="p_areaUnit">Area unit</label>
          <select id="p_areaUnit"></select>
        </div>
        <div><label for="p_type">Type</label>
          <select id="p_type"></select>
        </div>
        <div><label for="p_status">Status</label>
          <select id="p_status"></select>
        </div>
        <div><label for="p_scope">Scope</label>
          <select id="p_scope"></select>
        </div>
        <div><label for="p_cost">Estimated cost</label><input id="p_cost" type="number" step="0.01" placeholder="0.00" /></div>
        <div><label for="p_trackedTime">Time (h)</label><input id="p_trackedTime" type="number" step="1" placeholder="0" /></div>
        <div><label for="p_office">Office</label>
          <select id="p_office"></select>
        </div>
        <div><label for="p_client">Client</label>
          <select id="p_client"></select>
        </div>
        <div><label for="p_software">Software</label>
          <select id="p_software"></select>
        </div>
        <div style="grid-column:1/-1"><label for="p_notes">Notes</label><textarea id="p_notes" placeholder="Notes or comments"></textarea></div>
      </div>

      <div class="grid" style="margin-top:8px;">
        <div>
          <label for="p_pms">Assigned PM(s)</label>
          <div class="filters" id="pmFilters">
            <div>
              <label for="pm_q">Search name (PM)</label>
              <input id="pm_q" placeholder="E.g., Ana" />
            </div>
            <!-- PM job/department filters removed -->
          </div>
          <select id="p_pms" multiple size="8"></select>
          <div class="hint">Only employees with the Project Manager position are listed. Filter by name if needed.</div>
        </div>
        <div>
          <label for="p_team">Team</label>
          <div class="filters" id="teamFilters">
            <div>
              <label for="team_q">Search name</label>
              <input id="team_q" placeholder="E.g., Carlos" />
            </div>
            <div>
              <label for="team_job">Job position</label>
              <select id="team_job"></select>
            </div>
            <div>
              <label for="team_dept">Department</label>
              <select id="team_dept"></select>
            </div>
          </div>
          <select id="p_team" multiple size="8"></select>
          <div class="hint">Select multiple with Ctrl/Shift. You can combine filters by name, job position, and department.</div>
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
  <button id="p_create" class="btn btn-primary" type="button" [style.display]="isAdminOrOwner ? '' : 'none'">Create project</button>
        <span id="p_msg" class="muted"></span>
      </div>
    </div>
  </div>
</div>
