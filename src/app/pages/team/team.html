<!-- ‚úÖ Coloca tus componentes de encabezado -->
<app-header></app-header>
<app-submenu></app-submenu>

<!-- ‚úÖ Contenedor principal del TEAM -->
<div class="team-container">
  
    <h1>Equipo</h1>
  

  <!-- Filters form (Reactive) -->
<form [formGroup]="filterForm" class="filters-form" (ngSubmit)="$event.preventDefault()">

  <!-- Buscar por nombre -->
  <div class="filter-search">
    <label>Buscar por nombre</label>
    <input id="searchInput" type="text" placeholder="Ej: Carlos, Herrera" />
    <div class="muted">B√∫squeda parcial, sin distinguir may√∫sculas ni tildes. Filtra localmente.</div>
  </div>

  <!-- Filtros horizontales -->
 <div class="filters-row">
  <div class="filter-item">
    <label>Departamento</label>
    <select formControlName="department">
      <option value="">Todos</option>
      <option *ngFor="let d of (catalogs.departments || [])" [value]="(d.name ?? d)">
        {{ d.name ?? d }}
      </option>
    </select>
  </div>

  <div class="filter-item">
    <label>Cargo</label>
    <select formControlName="job">
      <option value="">Todos</option>
      <option *ngFor="let j of (catalogs.jobs || [])" [value]="(j.name ?? j)">
        {{ j.name ?? j }}
      </option>
    </select>
  </div>

  <div class="filter-item">
    <label>Oficina</label>
    <select formControlName="office">
      <option value="">Todas</option>
      <option *ngFor="let o of (catalogs.offices || [])" [value]="(o.name ?? o)">
        {{ o.name ?? o }}
      </option>
    </select>
  </div>

  <div class="filter-item">
    <label>Rol</label>
    <select formControlName="role">
      <option value="">Todos</option>
      <option *ngFor="let r of allowedRoleOptions" [value]="r">{{ r }}</option>
    </select>
  </div>

  <div class="filter-item">
    <label>Estado</label>
    <select formControlName="state">
      <option value="">Todos</option>
      <option value="ACTIVE">Activo</option>
      <option value="INACTIVE">Inactivo</option>
    </select>
  </div>
</div>


  <!-- üîΩ botones dentro del form -->
  <!-- üîπ Fila inferior: Mostrar por p√°gina + Botones -->
<div class="filters-row bottom-row">
  <div class="filter-item small">
    <label>Mostrar por p√°gina</label>
    <select formControlName="size">
      <option *ngFor="let s of pageSizes" [value]="s">{{ s }}</option>
    </select>
  </div>

  <div class="buttons-group">
    <button type="button" (click)="refreshData()" [disabled]="loading">Actualizar datos</button>
    <button type="button" (click)="filterForm.reset({ q: '', department: '', job: '', office: '', state: '', role: '', size: pageSizes[0] })">
      Limpiar filtros
    </button>
    <app-fagregar-miembro></app-fagregar-miembro>
  </div>
</div>

</form>  <!-- ‚úÖ ahora el form se cierra correctamente -->

    

    


  <!-- Status / error -->
  <div class="row status-row">
    <span class="muted" *ngIf="!error && !loading">{{ filtered.length }} resultados</span>
    <span class="muted" *ngIf="loading">Cargando empleados...</span>
    <span class="error" *ngIf="error">{{ error }}</span>
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <table class="team-table" *ngIf="!loading && filtered.length >= 0">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Departamento</th>
          <th>Oficina</th>
          <th>Posici√≥n</th>
          <th>Tarifa (por hora)</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of pagedResults">
          <td>{{ m.name ?? '(Sin nombre)' }}</td>
          <td>{{ m.departmentName ?? '-' }}</td>
          <td>{{ m.officeName ?? '-' }}</td>
          <td>{{ m.jobPositionName ?? '-' }}</td>
          <td>{{ m.billableRate != null ? m.billableRate : '-' }}</td>
          <td>{{ (m.accountRole ?? (m.roles?.[0] || '-')) }}</td>
          <td>{{ m.state ?? '-' }}</td>
          <td>
            <button class="btn-edit" (click)="abrirModal(m)">‚úèÔ∏è Editar</button>
            <button class="btn-delete" (click)="eliminarEmpleado(m.id)">üóëÔ∏è Eliminar</button>
          </td>
        </tr>
        <tr *ngIf="!pagedResults.length">
          <td colspan="8" class="muted">No hay resultados</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button (click)="setPage(1)" [disabled]="page === 1">¬´</button>
    <button (click)="setPage(page - 1)" [disabled]="page === 1">‚Äπ</button>

    <button *ngFor="let p of [].constructor(totalPages) | slice:0:totalPages; let i = index"
            (click)="setPage(i+1)"
            [class.active]="page === (i+1)">
      {{ i+1 }}
    </button>

    <button (click)="setPage(page + 1)" [disabled]="page === totalPages">‚Ä∫</button>
    <button (click)="setPage(totalPages)" [disabled]="page === totalPages">¬ª</button>
  </div>

  <!-- Modal editar -->
  <app-editar-miembro
    *ngIf="mostrarModal"
    [miembro]="miembroSeleccionado"
    [catalogs]="catalogs"
    [allowedRoles]="allowedRoleOptions"
    (cerrar)="cerrarModal()"
    (guardar)="guardarCambios($event)">
  </app-editar-miembro>

