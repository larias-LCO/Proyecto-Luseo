<div class="subtask-modal-overlay" (click)="cancel()">
	<div class="subtask-modal" style="max-width:900px;" (click)="$event.stopPropagation()">
		<div class="modal-header">
			<div>
				<div class="modal-title"><app-edit-icon [size]="37"></app-edit-icon><span>Create Reports</span> </div>
				<div class="modal-sub">Create one or more reports for project</div>
			</div>
			 
			<button class="modal-close" (click)="cancel()"><app-x-icon [size]="35" [color]="'red'"><div class="close">Close</div></app-x-icon>
		</button>
		</div>

		<div class="modal-body">
			<form [formGroup]="form">
				<div formArrayName="entries">
					<div *ngFor="let entry of entries.controls; let i = index" [formGroupName]="i" class="entry-row">
						<div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
							<div class="form-group">
									<label for="project-{{i}}">ğŸ“‹ Project <span class="req">*</span></label>
									<!-- If a preset project id was provided, hide the selector and keep the control value -->
									<div *ngIf="presetProjectId === undefined || presetProjectId === null">
										<select id="project-{{i}}" name="projectId-{{i}}" formControlName="projectId" class="form-input" autocomplete="off">
											<option value="">-- Select project --</option>
											<option *ngFor="let p of projects" [value]="p.id">{{p.projectCode}} - {{p.name}}</option>
										</select>
									</div>
									<div *ngIf="presetProjectId !== undefined && presetProjectId !== null">
										<input id="project-{{i}}" name="projectId-{{i}}" type="hidden" formControlName="projectId">
										<div class="preset-project">
											<span style="font-weight:700">Prefilled project:</span>
											<span style="margin-left:8px">{{ presetProjectLabel || 'N/A - Unknown Project' }}</span>
										</div>
											</div>
											<div class="field-error" *ngIf="entry.get('projectId')?.touched && entry.get('projectId')?.invalid">
												Project is required
											</div>
								</div>

							<div class="form-group">
								<label for="category-{{i}}">ğŸ“‚ Category <span class="req">*</span></label>
								<select id="category-{{i}}" name="subTaskCategoryId-{{i}}" formControlName="subTaskCategoryId" class="form-input" autocomplete="off">
									<option value="">-- Select category --</option>
									<option *ngFor="let c of filteredCategories" [value]="c.id">{{c.name}}</option>
								</select>
								<div class="field-error" *ngIf="entry.get('subTaskCategoryId')?.touched && entry.get('subTaskCategoryId')?.invalid">Category is required</div>
							</div>
						</div>

						<div class="form-group full-row">
							<label for="name-{{i}}">âœï¸ Description <span class="req">*</span></label>
							<textarea id="name-{{i}}" name="name-{{i}}" formControlName="name" class="form-input" rows="2" placeholder="Describe the task..." autocomplete="off"></textarea>
							<div class="field-error" *ngIf="entry.get('name')?.touched && entry.get('name')?.invalid">Description is required</div>
						</div>

						<div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
							<div class="form-group">
								<label for="hours-{{i}}">â° Time Worked <span class="req">*</span></label>
								<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
									<div>
										<input id="hours-{{i}}" name="hours-{{i}}" type="number" formControlName="hours" min="0" class="form-input" autocomplete="off" style="text-align: center;">
										<small style="display: block; text-align: center; color: #666; margin-top: 2px;">Hours</small>
									</div>
									<div>
										<input id="minutes-{{i}}" name="minutes-{{i}}" type="number" formControlName="minutes" min="0" max="59" class="form-input" autocomplete="off" style="text-align: center;">
										<small style="display: block; text-align: center; color: #666; margin-top: 2px;">Minutes</small>
									</div>
								</div>
							</div>
							<div class="field-error" *ngIf="(entry.get('hours')?.touched || entry.get('minutes')?.touched) && (entry.get('hours')?.errors || entry.get('minutes')?.errors)">
								<div *ngIf="entry.get('hours')?.errors?.['required'] || entry.get('minutes')?.errors?.['required']">Time is required</div>
								<div *ngIf="entry.get('minutes')?.errors?.['max']">Minutes must be less than 60</div>
							</div>

							<div class="form-group">
								<label for="date-{{i}}">ğŸ“… Date <span class="req">*</span></label>
								<input id="date-{{i}}" name="issueDate-{{i}}" type="date" formControlName="issueDate" class="form-input" autocomplete="off">
								<div class="field-error" *ngIf="entry.get('issueDate')?.touched && entry.get('issueDate')?.errors">
									<div *ngIf="entry.get('issueDate')?.errors?.['required']">Date is required</div>
									<div *ngIf="entry.get('issueDate')?.errors?.['weekend']">Weekends are not allowed</div>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label for="tag-{{i}}">ğŸ·ï¸ Tag</label>
							<select id="tag-{{i}}" name="tag-{{i}}" formControlName="tag" class="form-input" autocomplete="off">
								<option value="">None</option>
								<option value="FIRE_PROTECTION">ğŸ”¥ Fire Protection</option>
								<option value="PEER_REVIEW">ğŸ‘ï¸ Peer Review</option>
							</select>
						</div>

						<div class="entry-actions">
							<button type="button" class="delete-button" [title]="'Remove'" (click)="removeEntry(i)">
      <svg class="delete-svgIcon" viewBox="0 0 448 512">
                    <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
                  </svg>
    </button>



							<!-- <button class="delete-button" title="Remove" (clicked)="removeEntry(i)">
								<svg class="delete-svgIcon" viewBox="0 0 448 512">
									<path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
								</svg>
							</button> -->
						</div>
						<hr *ngIf="i < entries.length - 1">
					</div>
				</div>

				 <div class="form-controls">
            <button type="button" class="icon-btn" [title]="'Add another'" (click)="addEntry()">
              <app-mas-icon [size]="33"></app-mas-icon>
              <span class="add"  >Add Another</span>
            </button>
				</div>
			</form>
		</div>
			<div class="modal-footer">


				<!-- <app-icon-button title="Save" (clicked)="saveAll()">
					<app-file-check-icon [size]="25"></app-file-check-icon>
				</app-icon-button> -->

				<!-- From Uiverse.io by ilkhoeri --> 
         <div class="tooltip">
        <button type="button" class="action_has has_saved" aria-label="save" type="submit" (click)="saveAll()">
            <svg
    aria-hidden="true"
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    stroke-linejoin="round"
    stroke-linecap="round"
    stroke-width="2"
    viewBox="0 0 24 24"
    stroke="currentColor"
    fill="none"
  >
    <path
      d="m19,21H5c-1.1,0-2-.9-2-2V5c0-1.1.9-2,2-2h11l5,5v11c0,1.1-.9,2-2,2Z"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="box"
    ></path>
    <path
      d="M7 3L7 8L15 8"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-top"
    ></path>
    <path
      d="M17 20L17 13L7 13L7 20"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-bottom"
    ></path>
  </svg>
            </button>
            <span class="tooltip-text">Save Changes</span>
            </div>

			</div>
	</div>
</div>
