<div class="rh-internal-modal-overlay" (click)="onOverlayClick($event)">
  <div class="rh-internal-modal" style="max-width: 760px;">
    <div class="modal-header">
      <div>
        <div class="modal-title"><app-clock-icon [size]="30"></app-clock-icon> Report Internal Task</div>
        <div class="modal-sub">Report time for internal company activities</div>
      </div>
      <button class="modal-close" (click)="cancel()"><app-x-icon [size]="30" [color]="'red'">
        <div class="close">Close</div>
      </app-x-icon>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="form" (ngSubmit)="saveAll()">
        <div formArrayName="entries">
          <div *ngFor="let entry of entries.controls; let i = index" [formGroupName]="i" class="entry-row">
            <div class="grid-2">
              <div class="form-group">
                <label>üìÇ Category <span class="req">*</span></label>
                <select formControlName="mainTaskId" class="form-input" (change)="onMainChange(i)">
                  <option value="">-- Select a category --</option>
                  <option *ngFor="let t of getMainTasks()" [value]="t.id">{{t.name}}</option>
                </select>
                <div class="field-error" *ngIf="entry.get('mainTaskId')?.touched && entry.get('mainTaskId')?.invalid">Category is required</div>
              </div>

              <div class="form-group" *ngIf="getSubtasksFor(entry.get('mainTaskId')?.value).length > 0">
                <label>üóÇÔ∏è Subcategory</label>
                <select formControlName="subTaskId" class="form-input">
                  <option value="">-- No subcategory --</option>
                  <option *ngFor="let s of getSubtasksFor(entry.get('mainTaskId')?.value)" [value]="s.id">{{s.name}}</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>‚úèÔ∏è Description</label>
              <textarea formControlName="description" class="form-input" rows="2" placeholder="Describe what you worked on..."></textarea>
            </div>

            <div class="grid-2">
              <div class="form-group">
                <label>‚è∞ Time Worked <span class="req">*</span></label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                  <div>
                    <input type="number" formControlName="hours" class="form-input" min="0" placeholder="Hours" style="text-align: center;">
                    <small style="display: block; text-align: center; color: #666; margin-top: 2px;">Hours</small>
                  </div>
                  <div>
                    <input type="number" formControlName="minutes" class="form-input" min="0" max="59" placeholder="Min" style="text-align: center;">
                    <small style="display: block; text-align: center; color: #666; margin-top: 2px;">Minutes</small>
                  </div>
                </div>
                <div class="field-error" *ngIf="(entry.get('hours')?.touched || entry.get('minutes')?.touched) && (entry.get('hours')?.errors || entry.get('minutes')?.errors)">
                  <div *ngIf="entry.get('hours')?.errors?.['required'] || entry.get('minutes')?.errors?.['required']">Time is required</div>
                  <div *ngIf="entry.get('minutes')?.errors?.['max']">Minutes must be less than 60</div>
                </div>
              </div>

              <div class="form-group">
                <label>üìÖ Date <span class="req">*</span></label>
                <input type="date" formControlName="date" class="form-input">
                <div class="field-error" *ngIf="entry.get('date')?.touched && entry.get('date')?.errors">
                  <div *ngIf="entry.get('date')?.errors?.['required']">Date is required</div>
                  <div *ngIf="entry.get('date')?.errors?.['weekend']">Weekends are not allowed</div>
                </div>
              </div>
            </div>

            <div class="entry-actions">

              <!-- <app-icon-button title="Remove" (clicked)="entries.length > 1 && removeEntry(i)" [class.disabled]="entries.length <= 1">
                <app-archive-icon [size]="16"></app-archive-icon>
              </app-icon-button> -->

              <button class="delete-button" title="Remove" (clicked)="entries.length > 1 && removeEntry(i)" [class.disabled]="entries.length <= 1">
  <svg class="delete-svgIcon" viewBox="0 0 448 512">
                    <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
                  </svg>
</button>




              <app-icon-button title="Remove" (clicked)="entries.length > 1 && removeEntry(i)" [class.disabled]="entries.length <= 1">
                <app-archive-icon [size]="25"></app-archive-icon>
              </app-icon-button>

            </div>

            <hr *ngIf="i < entries.length - 1">
          </div>
        </div>

        <div class="form-controls">



          <app-icon-button  (clicked)="addEntry()">

            <app-mas-icon [size]="33"></app-mas-icon>
            <!-- <app-plus-icon [size]="18"></app-plus-icon> -->
            <span class="add" style="margin-left:8px" >Add Another</span>

          <app-icon-button title="Add another" (clicked)="addEntry()">
            <app-plus-icon [size]="25"></app-plus-icon>
            <span style="margin-left:8px"></span>

          </app-icon-button>

        </div>
      </form>
    </div>

    <div class="modal-footer">

      <!-- <app-icon-button title="Save" (clicked)="saveAll()">
					<app-file-check-icon [size]="25"></app-file-check-icon>
				</app-icon-button> -->

        <!-- From Uiverse.io by ilkhoeri --> 
         <div class="tooltip">
<button class="action_has has_saved" aria-label="save" type="submit" (clicked)="saveAll()">
  <svg
    aria-hidden="true"
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    stroke-linejoin="round"
    stroke-linecap="round"
    stroke-width="2"
    viewBox="0 0 24 24"
    stroke="currentColor"
    fill="none"
  >
    <path
      d="m19,21H5c-1.1,0-2-.9-2-2V5c0-1.1.9-2,2-2h11l5,5v11c0,1.1-.9,2-2,2Z"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="box"
    ></path>
    <path
      d="M7 3L7 8L15 8"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-top"
    ></path>
    <path
      d="M17 20L17 13L7 13L7 20"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-bottom"
    ></path>
  </svg>
</button> 
<span class="tooltip-text">Save Changes</span>
</div>


    </div>
  </div>
</div>