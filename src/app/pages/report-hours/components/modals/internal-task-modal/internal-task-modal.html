<div class="rh-internal-modal-overlay" (click)="onOverlayClick($event)">
  <div class="rh-internal-modal" style="max-width: 760px;">
    <div class="modal-header">
      <div>
        <h2 class="modal-title">üìù Report Internal Task</h2>
        <div class="modal-sub">Report time for internal company activities</div>
      </div>
      <button class="modal-close" (click)="cancel()"><app-x-icon [size]="25"></app-x-icon></button>
    </div>

    <div class="modal-body">
      <form [formGroup]="form" (ngSubmit)="saveAll()">
        <div formArrayName="entries">
          <div *ngFor="let entry of entries.controls; let i = index" [formGroupName]="i" class="entry-row">
            <div class="grid-2">
              <div class="form-group">
                <label>Category <span class="req">*</span></label>
                <select formControlName="mainTaskId" class="form-input" (change)="onMainChange(i)">
                  <option value="">-- Select a category --</option>
                  <option *ngFor="let t of getMainTasks()" [value]="t.id">{{t.name}}</option>
                </select>
                <div class="field-error" *ngIf="entry.get('mainTaskId')?.touched && entry.get('mainTaskId')?.invalid">Category is required</div>
              </div>

              <div class="form-group" *ngIf="getSubtasksFor(entry.get('mainTaskId')?.value).length > 0">
                <label>Subcategory</label>
                <select formControlName="subTaskId" class="form-input">
                  <option value="">-- No subcategory --</option>
                  <option *ngFor="let s of getSubtasksFor(entry.get('mainTaskId')?.value)" [value]="s.id">{{s.name}}</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label>Description</label>
              <textarea formControlName="description" class="form-input" rows="2" placeholder="Describe what you worked on..."></textarea>
            </div>

            <div class="grid-2">
              <div class="form-group">
                <label>Time Worked <span class="req">*</span></label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                  <div>
                    <input type="number" formControlName="hours" class="form-input" min="0" placeholder="Hours" style="text-align: center;">
                    <small style="display: block; text-align: center; color: #666; margin-top: 2px;">Hours</small>
                  </div>
                  <div>
                    <input type="number" formControlName="minutes" class="form-input" min="0" max="59" placeholder="Min" style="text-align: center;">
                    <small style="display: block; text-align: center; color: #666; margin-top: 2px;">Minutes</small>
                  </div>
                </div>
                <div class="field-error" *ngIf="(entry.get('hours')?.touched || entry.get('minutes')?.touched) && (entry.get('hours')?.errors || entry.get('minutes')?.errors)">
                  <div *ngIf="entry.get('hours')?.errors?.['required'] || entry.get('minutes')?.errors?.['required']">Time is required</div>
                  <div *ngIf="entry.get('minutes')?.errors?.['max']">Minutes must be less than 60</div>
                </div>
              </div>

              <div class="form-group">
                <label>Date <span class="req">*</span></label>
                <input type="date" formControlName="date" class="form-input">
                <div class="field-error" *ngIf="entry.get('date')?.touched && entry.get('date')?.errors">
                  <div *ngIf="entry.get('date')?.errors?.['required']">Date is required</div>
                  <div *ngIf="entry.get('date')?.errors?.['weekend']">Weekends are not allowed</div>
                </div>
              </div>
            </div>

            <div class="entry-actions">
              <app-icon-button title="Remove" (clicked)="entries.length > 1 && removeEntry(i)" [class.disabled]="entries.length <= 1">
                <app-archive-icon [size]="16"></app-archive-icon>
              </app-icon-button>
            </div>

            <hr *ngIf="i < entries.length - 1">
          </div>
        </div>

        <div class="form-controls">
          <app-icon-button title="Add another" (clicked)="addEntry()">
            <app-plus-icon [size]="18"></app-plus-icon>
            <span style="margin-left:8px"></span>
          </app-icon-button>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <app-icon-button title="Save" (clicked)="saveAll()">
					<app-file-check-icon [size]="25"></app-file-check-icon>
				</app-icon-button>
    </div>
  </div>
</div>