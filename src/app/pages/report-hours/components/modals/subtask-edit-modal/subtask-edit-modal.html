<div class="subtask-edit-modal-overlay" (click)="cancel()">
  <div class="subtask-edit-modal" style="max-width:640px;" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title"><app-file-pen-icon [size]="25"></app-file-pen-icon> Edit Report</h2>
      <button class="modal-close" (click)="cancel()"><app-x-icon [size]="25"></app-x-icon></button>
    </div>

    <div class="modal-body">
      <form [formGroup]="form">
        <div class="form-group">
          <label for="edit-project">ğŸ“‹ Project</label>
          <select id="edit-project" name="projectId" formControlName="projectId" class="form-input" autocomplete="off">
            <option *ngFor="let p of projects" [value]="p.id">{{p.projectCode}} - {{p.name}}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit-category">ğŸ“‚ Category</label>
          <select id="edit-category" name="subTaskCategoryId" formControlName="subTaskCategoryId" class="form-input" autocomplete="off">
            <option *ngFor="let c of filteredCategories" [value]="c.id">{{c.name}}</option>
          </select>
          <div class="field-error" *ngIf="form.get('subTaskCategoryId')?.touched && form.get('subTaskCategoryId')?.invalid">Category is required</div>
        </div>

        <div class="form-group">
          <label for="edit-name">âœï¸ Description</label>
          <textarea id="edit-name" name="name" formControlName="name" class="form-input" rows="2" placeholder="Describe the task..." autocomplete="off"></textarea>
          <div class="field-error" *ngIf="form.get('name')?.touched && form.get('name')?.invalid">Description is required</div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
          <div class="form-group">
            <label for="edit-hours">â° Time Worked</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
              <div>
                <input id="edit-hours" name="hours" type="number" formControlName="hours" min="0" class="form-input" autocomplete="off" style="text-align: center;">
                <small style="display: block; text-align: center; color: #666; margin-top: 2px;">Hours</small>
              </div>
              <div>
                <input id="edit-minutes" name="minutes" type="number" formControlName="minutes" min="0" max="59" class="form-input" autocomplete="off" style="text-align: center;">
                <small style="display: block; text-align: center; color: #666; margin-top: 2px;">Minutes</small>
              </div>
            </div>
          </div>
          <div class="field-error" *ngIf="(form.get('hours')?.touched || form.get('minutes')?.touched) && (form.get('hours')?.errors || form.get('minutes')?.errors)">
            <div *ngIf="form.get('hours')?.errors?.['required'] || form.get('minutes')?.errors?.['required']">Time is required</div>
            <div *ngIf="form.get('minutes')?.errors?.['max']">Minutes must be less than 60</div>
          </div>
          <div class="form-group">
            <label for="edit-date">ğŸ“… Date</label>
            <input id="edit-date" name="issueDate" type="date" formControlName="issueDate" class="form-input" autocomplete="off">
            <div class="field-error" *ngIf="form.get('issueDate')?.touched && form.get('issueDate')?.errors">
              <div *ngIf="form.get('issueDate')?.errors?.['required']">Date is required</div>
              <div *ngIf="form.get('issueDate')?.errors?.['weekend']">Weekends are not allowed</div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="edit-tag">ğŸ·ï¸ Tag</label>
          <select id="edit-tag" name="tag" formControlName="tag" class="form-input" autocomplete="off">
            <option value="">None</option>
            <option value="FIRE_PROTECTION">ğŸ”¥ Fire Protection</option>
            <option value="PEER_REVIEW">ğŸ‘ï¸ Peer Review</option>
          </select>
        </div>
      </form>

      <div class="form-group">
        <label>ğŸ‘¤ Created by</label>
        <input type="text" class="form-input" [value]="subtask?.createdByEmployeeName || ''" disabled>
      </div>

    </div>

    <div class="modal-footer">
      <ng-container *ngIf="canDelete">
        <app-icon-button title="Delete" (clicked)="deleteSubtask()">
          <app-archive-icon [size]="25"></app-archive-icon>
        </app-icon-button>
      </ng-container>
      <ng-container *ngIf="canEdit">
        <app-icon-button title="Save" (clicked)="saveChanges()">
          <app-file-check-icon [size]="25"></app-file-check-icon>
        </app-icon-button>
      </ng-container>
    </div>
  </div>
</div>
