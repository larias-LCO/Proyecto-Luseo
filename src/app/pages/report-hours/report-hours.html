<app-header></app-header>
<app-submenu></app-submenu>

<div class="report-hours">
  <!-- FILTERS -->
  <section class="report-section">
    <div class="section-body">
      <app-report-hours-filters
        [projects]="projects"
        [myEmployeeId]="employeeId"
        [isAdminOrOwner]="isAdminOrOwner"
        (projectsFiltered)="onProjectsFiltered($event)"
        (timeEntryFiltersChanged)="onTimeEntryFiltersChanged($event)"
        [employees]="employeesList">
      </app-report-hours-filters>
    </div>
  </section>

  <!-- PROJECT CARDS -->
  <section class="report-section report-section--flush">
    <div class="section-body">
      <div *ngIf="!loadingProjects">
        <app-project-cards
          [projects]="filteredProjects"
          (projectSelected)="onProjectSelected($event)">
        </app-project-cards>
      </div>
    </div>
  </section>

  <!-- CALENDAR -->
  <section class="report-section">
    <div class="section-body">
      <!-- Event template for FullCalendar (handles subtask, holiday, internal) -->
      <ng-template #eventTpl let-arg>
        <!-- Holiday -->
        <ng-container *ngIf="arg.event.extendedProps?.isHoliday; else notHoliday">
          <div [ngClass]="['rh-event','rh-event--holiday', (arg.event.extendedProps?.countryCode === 'CO' ? 'rh-event--holiday-co' : 'rh-event--holiday-us')]">
            <div class="rh-event__head">
              <span class="rh-event__flag">{{ arg.event.extendedProps?.countryCode === 'CO' ? 'ğŸ‡¨ğŸ‡´' : 'ğŸ‡ºğŸ‡¸' }}</span>
              <span class="rh-event__country">{{ arg.event.extendedProps?.countryName }}</span>
            </div>
            <div class="rh-event__title">ğŸ‰ {{ arg.event.extendedProps?.originalName || (arg.event.title ? (arg.event.title.replace((arg.event.extendedProps?.countryCode === 'CO' ? 'ğŸ‡¨ğŸ‡´' : 'ğŸ‡ºğŸ‡¸'), '') ) : '') }}</div>
            <div class="rh-event__note">ğŸš« No Working Day</div>
          </div>
        </ng-container>

        <ng-template #notHoliday>
          <!-- Internal task -->
          <ng-container *ngIf="arg.event.extendedProps?.isInternalTask; else subtaskTpl">
            <div class="rh-event rh-event--internal">
              <div class="rh-event__head">
                <span class="rh-event__title">ğŸ“ {{ arg.event.extendedProps?.description || arg.event.extendedProps?.categoryName }}</span>
                <span class="rh-event__badge">INTERNAL</span>
              </div>

              <div class="rh-event__meta">
                <span class="rh-event__hours">â±ï¸ {{ arg.event.extendedProps?.hours }}h</span>
              </div>

              <div class="rh-event__footer">
                <div class="rh-event__project">
                  <span class="rh-icon">ğŸ“‚</span>
                  <span class="rh-text" title="{{ arg.event.extendedProps?.categoryName }}">{{ arg.event.extendedProps?.categoryName }}</span>
                </div>
                <ng-container *ngIf="arg.event.extendedProps?.createdBy">
                  <div class="rh-event__creator">
                    <span class="rh-icon">ğŸ‘¤</span>
                    <span class="rh-text" title="{{ arg.event.extendedProps?.createdBy }}">{{ arg.event.extendedProps?.createdBy }}</span>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-container>

          <!-- Subtask default -->
          <ng-template #subtaskTpl>
            <div class="rh-event rh-event--subtask">
              <div class="rh-event__head">
                <span class="rh-event__title">ğŸ’¼ {{ arg.event.title }}</span>
                <ng-container [ngSwitch]="arg.event.extendedProps?.tag">
                  <span *ngSwitchCase="'FIRE_PROTECTION'" class="rh-badge rh-badge--fire">ğŸ”¥ FIRE</span>
                  <span *ngSwitchCase="'PEER_REVIEW'" class="rh-badge rh-badge--review">ğŸ‘ï¸ REVIEW</span>
                </ng-container>
              </div>

              <div class="rh-event__meta">
                <span class="rh-event__hours">â±ï¸ {{ arg.event.extendedProps?.hours }}h</span>
              </div>

              <div class="rh-event__footer">
                <div class="rh-event__project">
                  <span class="rh-icon">ğŸ¢</span>
                  <span class="rh-text" title="{{ arg.event.extendedProps?.projectCode }}">{{ arg.event.extendedProps?.projectCode }}</span>
                  -
                  <span class="rh-text" title="{{ arg.event.extendedProps?.projectName }}">{{ arg.event.extendedProps?.projectName }}</span>
                </div>
                <ng-container *ngIf="arg.event.extendedProps?.categoryName">
                  <div class="rh-event__project">
                    <span class="rh-icon">ğŸ“‚</span>
                    <span class="rh-text" title="{{ arg.event.extendedProps?.categoryName }}">{{ arg.event.extendedProps?.categoryName }}</span>
                  </div>
                </ng-container>
                <ng-container *ngIf="arg.event.extendedProps?.createdBy">
                  <div class="rh-event__creator">
                    <span class="rh-icon">ğŸ‘¤</span>
                    <span class="rh-text" title="{{ arg.event.extendedProps?.createdBy }}">{{ arg.event.extendedProps?.createdBy }}</span>
                  </div>
                </ng-container>
              </div>
            </div>
          </ng-template>
        </ng-template>
      </ng-template>

      <app-calendar [entries]="timeEntries" [eventTemplate]="eventTpl"></app-calendar>
    </div>
  </section>

</div>