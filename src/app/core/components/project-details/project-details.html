

<!-- Single, well-formed modal template for project details -->
<div class="modal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">

    <!-- ‚ö†Ô∏è Mostrar mensaje de error si algo falla -->
<div *ngIf="errorMessage" class="error-message">
  {{ errorMessage }}
</div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-box" role="status" aria-live="polite">
    <div class="loader-wrap">
      <div class="spinner" aria-hidden="true"></div>
      <div class="spinner-glow" aria-hidden="true"></div>
    </div>

    <div class="loading-text">
      <span class="loading-label">Loading</span>
      <span class="loading-dots" aria-hidden="true"><span></span><span></span><span></span></span>
      <div class="loading-subtext">Please wait ‚Äî fetching project details</div>
    </div>

    <div class="skeleton shimmer">
      <div class="s-line"></div>
      <div class="s-line short"></div>
      <div class="s-line"></div>
    </div>
  </div>

  <!-- HEADER FIJO -->
  <div *ngIf="!isLoading && project" class="modal-header">
    <h1> <app-details-icon [size]="36"></app-details-icon> Project Details</h1>
     <app-x-icon class="close-button" (click)="closeModal()" [size]="35" [color]="'red'">
  <div class="close">Close</div>
 </app-x-icon>

  </div>

  <div *ngIf="!isLoading && project" class="project-body">
    <ng-container *ngIf="!errorMessage && !isLoading && project">

      <!-- ABAJO DEL HEADER -->
      <div class="section-header2">
        <span class="title-head2">{{ project.projectCode }}</span>
        <div class="head-name2" [title]="project.name">{{ project.name || '' }}</div>
        <span class="status-head2" [ngClass]="getStatusClass(project.status)"> {{ project.status?.toLowerCase() }} </span>
        </div>

      <!-- META CHIPS -->
 <div class="meta-grid">

  <div class="meta-card">
    <label> üìç Office</label>
    <span>{{ project.officeName || '-' }}</span>
  </div>

  <div class="meta-card">
    <label> üë• Client</label>
    <span>{{ project.clientName || '-' }}</span>
  </div>

  <div class="meta-card">
    <label> üíª Software</label>
    <span>{{ project.softwareName || '-' }}</span>
  </div>

  <div class="meta-card">
    <label>üóÇÔ∏è  Type</label>
    <span>{{ project.projectType || '-' }}</span>
  </div>

  <div class="meta-card">
    <label>üéØ Scope</label>
    <span>{{ project.scope || '-' }}</span>
  </div>


  <!-- NEW: Mostrar fase actual si existe -->
  <div class="meta-card" *ngIf="currentPhaseName">
    <label>Phase</label>
    <span>{{ currentPhaseName }}</span>
  </div>

  <!-- <div class="meta-card" *ngFor="let pm of pmSelected">
    <label>PM</label>
    <span>{{ employeeOptionLabel(pm) }}</span>
  </div> -->

</div>



      <hr class="pd-divider" />

      <!-- <div class="pd-section">
        <h3>Team Members</h3>
        <div class="chip-list">
          <span *ngFor="let member of team" class="chip team">{{ member.name }}</span>
        </div>
      </div> -->

      <!-- ============================= -->
      <!--  METRICS SECTION (solo USER) -->
      <!-- ============================= -->
      <div *ngIf="roles && roles.length && roles[0].toUpperCase() === 'OWNER'" class="pd-section">
        <h3 class="title-section"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-chart-ppf"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 17c0 -6.075 -5.373 -11 -12 -11" /><path d="M3 3v18h18" /></svg>METRICS</h3>
        <div class="pd-metrics">
          <ng-container *ngIf="metricsList.length; else defaultMetrics">
            <div class="metric" *ngFor="let m of metricsList">
              <span class="dot" [ngClass]="m.dot"></span>
              <span>{{ m.label }}:</span>
              <strong>{{ m.value }}</strong>
            </div>
          </ng-container>
          <ng-template #defaultMetrics>
            <div class="metric" *ngIf="project.cost">
              <span class="dot dot-cost"></span>
              <span>Estimated cost:</span>
              <strong>{{ project.cost }}</strong>
            </div>
            <div class="metric" *ngIf="project.realCost">
              <span class="dot dot-cost"></span>
              <span>Accumulated project cost:</span>
              <strong>{{ project.realCost }}</strong>
            </div>
            <div class="metric" *ngIf="project.estimatedTime">
              <span class="dot dot-time"></span>
              <span>Estimated time:</span>
              <strong>{{ project.estimatedTime }}</strong>
            </div>
            <div class="metric" *ngIf="project.trackedTime">
              <span class="dot dot-time"></span>
              <span>Accumulated project time:</span>
              <strong>{{ project.trackedTime }}</strong>
            </div>
          </ng-template>
        </div>
      </div>
      <hr class="pd-divider" *ngIf="roles && roles.length && roles[0].toUpperCase() === 'OWNER'" />

<!-- ============================= -->
<!--  DETAILS SECTION -->
<!-- ============================= -->
<div class="pd-section">
  <h3 class="title-section"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-clear-all"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 6h12" /><path d="M6 12h12" /><path d="M4 18h12" /></svg>DETAILS</h3>

  <div class="pd-details">

    <div class="detail-card">
      <label>üè∑Ô∏è PROJECT CODE</label>
      <span>{{ project.projectCode || '-' }}</span>
    </div>

    <div class="detail-card">
      <label>üìê AREA</label>
      <span>{{ project.projectArea !== undefined && project.projectArea !== null && project.projectArea !== '' ? project.projectArea : '-' }}</span>
    </div>

    <div class="detail-card">
      <label>üî¢ AREA UNIT</label>
      <span>{{ project.areaUnit || '-' }}</span>
    </div>


    

  </div>
</div>

<hr class="pd-divider" />
<!-- ============================= -->
<!--  PEOPLE SECTION -->
<!-- ============================= -->
<div class="pd-section">
  <h3 class="title-section"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-users"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 7a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" /><path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /><path d="M21 21v-2a4 4 0 0 0 -3 -3.85" /></svg>PEOPLE</h3>

  <div class="pd-grid">
    <!-- Project Managers -->
    <div class="pair">
      <label>üë®‚Äçüíº PROJECT MANAGER(S)</label>
      <div class="val">
  <ng-container *ngIf="pmSelected.length; else noPMs">
    <span *ngFor="let pm of pmSelected; let last = last">
      {{ pm.name }}<span *ngIf="!last">, </span>
    </span>
  </ng-container>
  <ng-template #noPMs><span class="muted">-</span></ng-template>
      </div>
    </div>

    <!-- Team -->
    <div class="pair">
      <label>üë• TEAM</label>
      <div class="val">
  <ng-container *ngIf="team.length; else noTeam">
          <span *ngFor="let member of team" class="chip team">{{ employeeOptionLabel(member) }}</span>
        </ng-container>
        <ng-template #noTeam><span class="muted">-</span></ng-template>
      </div>
    </div>
  </div>
  </div>

  <hr class="pd-divider" />

  <!-- PHASES CARDS SECTION -->
  <div class="pd-section">
    <h3 class="title-phases"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-asana"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 7a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M14 16a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M4 16a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /></svg>PROJECT PHASES</h3>
    <div class="phases-container">
      <ng-container *ngIf="phases && phases.length > 0; else noPhases">
        <ng-container *ngFor="let phase of phases">
          <div class="phase-card" [ngClass]="{'phase-active': (phase.status || '').toUpperCase() === 'ACTIVE'}">
            <div class="phase-name">{{ phase.phase || '-' }}</div>
            <span class="phase-status">{{ (phase.status || 'ACTIVE') | lowercase }}</span>
            <div class="phase-dates">Start: {{ phase.startDate || '-' }}  |  End: {{ phase.endDate || 'ongoing' }}</div>
          </div>
          <div style="height: 16px;"></div> <!-- Espaciado entre tarjetas -->
        </ng-container>
      </ng-container>
      <ng-template #noPhases>
        <div class="muted">No phases defined for this project</div>
      </ng-template>
    </div>
  </div>

 


  <hr class="pd-divider" />

<!-- ============================= -->
<!-- DEPARTMENTS & ROLES -->
<!-- ============================= -->
<div class="pd-section">
  <h3 class="title-section"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-building-skyscraper"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 21l18 0" /><path d="M5 21v-14l8 -4v18" /><path d="M19 21v-10l-6 -4" /><path d="M9 9l0 .01" /><path d="M9 12l0 .01" /><path d="M9 15l0 .01" /><path d="M9 18l0 .01" /></svg>DEPARTMENTS & ROLES</h3>
  <div class="pd-grid">

    <!-- Departments -->
    <div class="pair">
      <label>üè¢ DEPARTMENTS PARTICIPATING</label>
      <div class="val">
        <ng-container *ngIf="assignedDeps.length; else noDeps">
          <span *ngFor="let dep of assignedDeps" class="chip">{{ dep }}</span>
        </ng-container>
        <ng-template #noDeps>
          <span class="muted">-</span>
        </ng-template>
      </div>
    </div>

    <!-- Roles -->
    <div class="pair">
      <label>üé≠ ROLES PARTICIPATING</label>
      <div class="val">
        <ng-container *ngIf="assignedRoles.length; else noRoles">
          <span *ngFor="let role of assignedRoles" class="chip">{{ role }}</span>
        </ng-container>
        <ng-template #noRoles>
          <span class="muted">-</span>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- ============================= -->
<!--  NOTES SECTION -->
<!-- ============================= -->
<hr class="pd-divider" />

<div class="pd-section">
  <h3 class="title-section"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notes"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 5a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2l0 -14" /><path d="M9 7l6 0" /><path d="M9 11l6 0" /><path d="M9 15l4 0" /></svg> NOTES</h3>
  <div class="note-box">
    {{ project.notes || 'No notes available.' }}
  </div>
</div>

</ng-container>

<!-- ============================= -->
<!-- ACTIONS -->
<!-- ============================= -->

<div class="pd-actions row">
  <!-- <button class="btn-soft edit" (click)="openEditModal()">
    <span class="icon">‚úèÔ∏è</span>
    Edit
  </button> --> 

  <!-- From Uiverse.io by aaronross1 --> 
<button class="edit-button" (click)="openEditModal()" *ngIf="isAdminOrOwner">
  <svg class="edit-svgIcon" viewBox="0 0 512 512">
                    <path d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z"></path>
                  </svg>
</button>

<!-- From Uiverse.io by aaronross1 --> 
<button class="delete-button" (click)="deleteProject()" *ngIf="isAdminOrOwner">
  <svg class="delete-svgIcon" viewBox="0 0 448 512">
                    <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
                  </svg>
</button>
  <!-- <button  class="btn-soft delete" (click)="deleteProject()">
    <span class="icon">üóëÔ∏è</span>
    Delete
  </button> -->
</div>



  </div>
</div>

<!-- Modal de confirmaci√≥n para eliminar proyecto -->
<app-confirm-modal
  *ngIf="showConfirmModal"
  [message]="'¬øSeguro que deseas eliminar el proyecto \'' + confirmDeleteName + '\'? Esta acci√≥n no se puede deshacer.'"
  [confirmText]="'Eliminar'"
  [cancelText]="'Cancelar'"
  (confirm)="confirmDeleteProject()"
  (cancel)="cancelDeleteProject()"
></app-confirm-modal>


