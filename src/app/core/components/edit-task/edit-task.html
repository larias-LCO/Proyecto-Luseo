<div class="modal-backdrop" (click)="closeModal()"></div>
<div class="modal-container">
  <div class="modal-header">
    <h2><app-edit-icon [size]="40"></app-edit-icon> Edit Task</h2>
 <app-x-icon class="close-button" (click)="closeModal()" [size]="35" [color]="'red'">
  <div class="close">Close</div>
 </app-x-icon>
  </div>
  <div class="modal-body-new">
    <form>
      <div class="form-group full">
        <label>ğŸ“ Task Name *</label>
        <input type="text" [value]="task.name" readonly />
      </div>
      <div class="grid">
        <div>
          <h3 class="section-title">ğŸ“ Project Information</h3>
          <div class="form-group">
            <label>Project</label>
            <select [(ngModel)]="task.projectId" name="projectId" (change)="loadPhases(task.projectId)" [disabled]="!canEditTask">
              <option value="" disabled selected>Seleccione un proyecto</option>
              <option *ngFor="let p of allProjects" [value]="p.id + ''">{{ p.name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Phase</label>
            <select [(ngModel)]="task.projectPhaseId" name="projectPhaseId" (change)="loadPhases(task.projectPhaseId)" [disabled]="!canEditTask">
              <option *ngFor="let ph of projectPhaseId" [value]="ph.id">{{ ph.phase }}</option>
              <option value="None">None</option>
            </select>
          </div>
          <div class="form-group">
            <label>Category *</label>
            <select [(ngModel)]="task.taskCategoryId" name="taskCategoryId" [disabled]="!canEditTask">
              <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
            </select>
          </div>
        </div>
        <div>
          <h3 class="section-title">ğŸ“… Dates & Status</h3>
          <div class="form-group">
            <label>Issued Date</label>
            <input type="date" [(ngModel)]="task.issuedDate" name="issuedDate" [disabled]="!canEditTask" />
          </div>
          <div class="form-group" *ngIf="showEndDate">
            <label>End Date (Vacations Only)</label>
            <input type="date" [(ngModel)]="task.endDate" name="endDate" [disabled]="!canEditTask" />
            <small style="color: #64748b; font-size: 12px;">Tasks will be created for each day in the range</small>
          </div>
          <div class="form-group">
            <label>Status *</label>
            <select [(ngModel)]="task.status" name="status" [disabled]="!canEditTask">
              <option value="IN_PROGRESS">In Progress</option>
              <option value="COMPLETED">Completed</option>
              <option value="PAUSED">Paused</option>
            </select>
          </div>
          <div class="mini-container">
            <label>Created By</label>
            <div class="created-box">
              <span class="user-icon">ğŸ‘¤</span>
              <span *ngIf="task.createdByEmployeeId">{{ getEmployeeNameById(task.createdByEmployeeId) }}</span>
            </div>
          </div>
          <div id="edit-task-message" class="muted" style="text-align: center;">{{ message }}</div>
        </div>
      </div>
      <div class="description">
        <label><span class="icon">ğŸ“„</span>Description</label>
        <textarea [(ngModel)]="task.description" name="description" [disabled]="!canEditTask"></textarea>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    
      <!-- <button *ngIf="canDeleteTask" type="button" class="btn-delete" (click)="deleteTask()"><span class="icon">ğŸ—‘ï¸</span> Delete</button> -->
      <button *ngIf="canDeleteTask" type="button" class="btn-delete" (click)="deleteTask()" class="delete-button">
  <svg class="delete-svgIcon" viewBox="0 0 448 512">
                    <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
                  </svg>
</button>


      <div class="actions">
      <!-- <button type="button" class="cancel-btn" (click)="closeModal()"><span class="icon">âŒ</span> Cancel </button> -->
       <button type="button" class="noselect" (click)="closeModal()"><span class="text" >Cancel</span></button>


      <!-- <button *ngIf="canEditTask" type="button" class="save-btn" (click)="saveTask()"><span class="icon">ğŸ“</span> Save Changes</button> -->
       <div class="tooltip">
      <button *ngIf="canEditTask" type="button" class="action_has has_saved" (click)="saveTask()" aria-label="save" type="submit">
  <svg
    aria-hidden="true"
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    stroke-linejoin="round"
    stroke-linecap="round"
    stroke-width="2"
    viewBox="0 0 24 24"
    stroke="currentColor"
    fill="none"
  >
    <path
      d="m19,21H5c-1.1,0-2-.9-2-2V5c0-1.1.9-2,2-2h11l5,5v11c0,1.1-.9,2-2,2Z"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="box"
    ></path>
    <path
      d="M7 3L7 8L15 8"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-top"
    ></path>
    <path
      d="M17 20L17 13L7 13L7 20"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-bottom"
    ></path>
  </svg>
</button> 
<span class="tooltip-text">Save Changes</span>
</div>


      <!-- MODAL DE Ã‰XITO PERSONALIZADO -->
      <div *ngIf="showSuccessModal" class="modal-show" style="z-index:9999;background:rgba(0,0,0,0.18);display:flex;align-items:center;justify-content:center;position:fixed;left:0;top:0;width:100vw;height:100vh;">
        <div style="background:#fff;padding:32px 36px 28px 36px;border-radius:16px;box-shadow:0 2px 16px rgba(0,0,0,0.10);text-align:center;min-width:320px;max-width:90vw;margin:auto;">
          <div style="font-size:48px;color:#10b981;margin-bottom:8px;">âœ”ï¸</div>
          <div style="font-size:22px;font-weight:600;margin-bottom:8px;">Â¡Tarea editada exitosamente!</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmaciÃ³n para eliminar tarea -->
<app-confirm-modal 
  *ngIf="showDeleteConfirmModal"
  message="Are you sure you want to delete this task? This will also delete all associated subtasks."
  confirmText="Delete"
  cancelText="Cancel"
  (confirm)="confirmDelete()"
  (cancel)="cancelDelete()">
</app-confirm-modal>
