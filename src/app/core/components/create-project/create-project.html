<!-- Modal de Ã©xito -->
<div *ngIf="showSuccessModal" class="modal success-modal" style="display:flex;align-items:center;justify-content:center;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.2)">
  <div style="background:#fff;border-radius:12px;padding:32px 40px;box-shadow:0 4px 24px #0002;display:flex;flex-direction:column;align-items:center;gap:12px;min-width:260px">
    <div style="font-size:2.5rem;color:#10b981;">âœ”</div>
    <div style="font-size:1.2rem;font-weight:600;">Â¡Proyecto creado exitosamente!</div>
  </div>
</div>
<!-- Create project modal -->
<div id="createModal" class="modal" [class.show]="visible" (click)="closeModal()">
  <div *ngIf="visible">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="createTitle" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div id="createTitle" style="font-weight:600"><app-mas-icon [size]="35"></app-mas-icon> Create project</div>
         <app-x-icon class="close-button" (click)="closeModal()" [size]="35" [color]="'red'">
  <div class="close">Close</div>
 </app-x-icon>

      </div>

    <div id="createBody" class="modal-body">
      <div class="grid">
        <div>
          <label for="p_code">Code</label>
          <input id="p_code" name="p_code" [(ngModel)]="project.projectCode" placeholder="PRJ-001"
            (input)="onProjectCodeInput()"
            [style.border-color]="project.projectCode ? (projectCodeDuplicate ? '#ef4444' : '#10b981') : ''"
            [attr.aria-invalid]="projectCodeDuplicate ? 'true' : null"
          />
          <small class="code-feedback" *ngIf="project.projectCode">
            <span *ngIf="projectCodeDuplicate" style="color:#ef4444">âš ï¸ Este cÃ³digo ya existe</span>
            <span *ngIf="!projectCodeDuplicate" style="color:#10b981">âœ“ CÃ³digo disponible</span>
          </small>
        </div>
        <div><label for="p_name">ğŸ·ï¸ Name</label><input id="p_name" name="p_name" [(ngModel)]="project.name" placeholder="Project name" /></div>
        <div><label for="p_area">ğŸ“ Area</label><input id="p_area" name="p_area" [(ngModel)]="project.projectArea" type="number" step="0.01" placeholder="0.00" /></div>
        <div><label for="p_areaUnit">ğŸ”¢ Area unit</label>
          <select id="p_areaUnit" name="p_areaUnit" [(ngModel)]="project.areaUnit">
            <option *ngFor="let a of enums.areaUnit" [value]="a" >{{ a }}</option>
          </select>
        </div>
        <div><label for="p_type"> ğŸ—‚ï¸ Type</label>
          <select id="p_type" name="p_type" [(ngModel)]="project.projectType">
            <option *ngFor="let t of enums.type" [value]="t">{{ displayEnum(t) }}</option>
          </select>
        </div>
        <div><label for="p_status">ğŸŸ¢ Status</label>
          <select id="p_status" name="p_status" [(ngModel)]="project.status">
            <option *ngFor="let s of enums.status" [value]="s">{{ displayEnum(s) }}</option>
          </select>
        </div>
        <div><label for="p_scope">ğŸ¯ Scope</label>
          <select id="p_scope" name="p_scope" [(ngModel)]="project.scope">
            <option *ngFor="let s of enums.scope" [value]="s">{{ displayEnum(s) }}</option>
          </select>
        </div>
  <div><label for="p_trackedTime">â±ï¸ Time (h)</label><input id="p_trackedTime" name="p_trackedTime" [(ngModel)]="project.trackedTime" type="number" step="1" placeholder="0" /></div>
        <div><label for="p_office">ğŸ¢ Office</label>
          <select id="p_office" name="p_office" [(ngModel)]="project.officeId">
            <option *ngFor="let o of offices" [ngValue]="o.id">{{ o.name }}</option>
          </select>
        </div>
        <div><label for="p_client">ğŸ‘¥ Client</label>
          <select id="p_client" name="p_client" [(ngModel)]="project.clientId">
            <option *ngFor="let c of clients" [ngValue]="c.id">{{ c.name }}</option>
          </select>
        </div>
        <div><label for="p_software">ğŸ’» Software</label>
          <select id="p_software" name="p_software" [(ngModel)]="project.softwareId">
            <option *ngFor="let s of software" [ngValue]="s.id">{{ s.name }}</option>
          </select>
        </div>


         <div>
           <label for="p_phase">ğŸ”„ Project phase (optional)</label>
           <select id="p_phase" [(ngModel)]="project.phaseId">
             <option value="">None</option>
             <option *ngFor="let ph of phaseOptions" [value]="ph.value">{{ ph.label }}</option>
           </select>
         </div>

         <div *ngIf="project.phaseId">
           <label for="p_phaseStatus">Phase status</label>
           <select id="p_phaseStatus" [(ngModel)]="project.phaseStatus">
             <option value="">None</option>
             <option *ngFor="let s of phaseStatusOptions" [value]="s.value">{{ s.label }}</option>
           </select>
         </div>
         <div *ngIf="project.phaseId">
           <label for="p_phaseStartDate">Phase start date (optional)</label>
           <input id="p_phaseStartDate" type="date" [(ngModel)]="phaseStartDate" />
         </div>
        <div style="grid-column:1/-1"><label for="p_notes">ğŸ“ Notes</label><textarea id="p_notes" name="p_notes" [(ngModel)]="project.notes" placeholder="Notes or comments"></textarea></div>

  

          <div class="two-column-grid" style="grid-column: 1 / -1;">
    <div class="section-title">
      <app-team-icon [size]="24"></app-team-icon> <span>Team Assignment</span>
      </div>

          <!-- LEFT SIDE: Team -->
          <div class="filter-team">
            <label>Team Members </label>
            <!-- selected team members box -->
            <div class="selected-box">
              <div *ngIf="teamSelectedEmployees.length; else noTeam">
                <div class="chip" *ngFor="let emp of teamSelectedEmployees">
                  <span class="chip-avatar">{{ getInitials(emp.name) }}</span>
                  <span class="chip-label">{{ emp.name }} <small class="chip-meta">Â· {{ emp.jobTitle }}{{ emp.department ? ' Â· ' + emp.department : '' }}</small></span>
                  <button type="button" class="chip-remove" (click)="removeFromTeam(emp.id)">âœ•</button>
                </div>
              </div>
              <ng-template #noTeam>
                <div class="empty-note">No team members assigned yet.</div>
              </ng-template>
            </div>
            <div class="filters">
              <div>
                <input [(ngModel)]="teamQuery" (input)="applyFilters()" placeholder="Search Name" />
              </div>
              <div>
                <select [(ngModel)]="teamJob" (change)="applyFilters()">
                  <option value="">Job position</option>
                  <option *ngFor="let job of teamJobs" [value]="job.name">{{ job.name }}</option>
                </select>
              </div>
              <div>
                <select [(ngModel)]="teamDept" (change)="applyFilters()">
                  <option value="">Department</option>
                  <option *ngFor="let dept of teamDepartments" [value]="dept.name">{{ dept.name }}</option>
                </select>
              </div>
            </div>

            <select multiple size="8" [(ngModel)]="teamSelection">
              <option *ngFor="let emp of teamFiltered" [ngValue]="emp.id" (mousedown)="$event.preventDefault(); toggleTeam(emp.id)">
                {{ (teamSelection.includes(emp.id) ? 'âœ” ' : '') + (emp.name || '') + ' Â· ' + (emp.jobTitle || '') + (emp.department ? ' Â· ' + emp.department : '') }}
              </option>
            </select>

            <div class="hint">
              Team shows only the following roles: Coordinator, Designer, Drafter, Engineer, and Senior Engineer.
              Select multiple with Ctrl/Shift; combine filters by name, job position, and department.
            </div>
          </div>

          <!-- RIGHT SIDE: Assigned PM(s) -->
          <div class="filter-pm">
            <label class="titulopm">Projects Manager</label>
            <!-- selected PMs box -->
            <div class="selected-box">
              <div *ngIf="pmSelectedEmployees.length; else noPM">
                <div class="chip" *ngFor="let emp of pmSelectedEmployees">
                  <span class="chip-avatar">{{ getInitials(emp.name) }}</span>
                  <span class="chip-label">{{ emp.name }} <small class="chip-meta">Â· {{ emp.jobTitle }}{{ emp.department ? ' Â· ' + emp.department : '' }}</small></span>
                  <button type="button" class="chip-remove" (click)="removeFromPM(emp.id)">âœ•</button>
                </div>
              </div>
              <ng-template #noPM>
                <div class="empty-note">No PMs assigned yet.</div>
              </ng-template>
            </div>
            <div class="filters">
              <div>

                <input [(ngModel)]="pmQuery" (input)="applyFilters()" placeholder="Search name (PM)" />
              </div>
            </div>

            <select multiple size="8" [(ngModel)]="pmSelection">
              <option *ngFor="let emp of pmFiltered" [ngValue]="emp.id" (mousedown)="$event.preventDefault(); togglePM(emp.id)">
                {{ (pmSelection.includes(emp.id) ? 'âœ” ' : '') + (emp.name || '') + ' Â· ' + (emp.jobTitle || '') + (emp.department ? ' Â· ' + emp.department : '') }}
              </option>
            </select>

            <div class="hint">
              Only employees with roles: Project Manager, Manager, Coordinator, or Senior Engineer are listed.
              Use the name search to narrow down.
            </div>
          </div>
        </div> <!-- end two-column-grid -->
        <div class="footer-row" style="grid-column:1/-1; display:flex; justify-content:flex-end; gap:12px; margin-top:12px;">
          <!-- <button id="p_create" class="btn btn-primary" type="button" (click)="onSubmit()">Create project</button> -->
<!-- From Uiverse.io by cssbuttons-io --> 
<button id="p_create" class="btnccc" type="button" (click)="onSubmit()"> Create project </button>



          <span id="p_msg" class="muted">{{ message }}</span>
        </div>
      </div> <!-- end .grid -->
    </div> <!-- end .modal-body -->
  </div> <!-- end .modal-card -->
</div> <!-- end #createModal -->

    

