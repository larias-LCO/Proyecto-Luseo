<div class="tooltip">
  <button class="btn-agregar" (click)="abrirModal()">Add New Member</button>
  <span class="tooltip-text">Create a new member by assigning their data and corresponding role.</span>
</div>

<div class="modal-backdrop" *ngIf="mostrarModal">
  <div class="modal">
    <h2>Add New Member</h2>
    <hr>

    <form [formGroup]="form">

    <!-- PASO 1 -->
     
    <div *ngIf="paso === 1" class="form-grid">
      <div class="form-control">
        <label >Name</label>
        <input type="text" placeholder="Name" formControlName="nombre"
          [ngClass]="{ 'input-error': form.get('nombre')?.invalid && form.get('nombre')?.touched }">
        <small *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched">
          The name is required
        </small>
      </div>

      <!-- DEPARTAMENTO -->
      <div class="form-control">
        <label>Department</label>
        <select formControlName="departamento"
          [ngClass]="{ 'input-error': form.get('departamento')?.invalid && form.get('departamento')?.touched }">
          <option value="" disabled>Select a department</option>
          <option *ngFor="let d of (catalogs?.departments || [])" [value]="d?.name || d?.label || d?.title || d?.descripcion">{{ d?.name || d?.label || d?.title || d?.descripcion }}</option>
        </select>
        <small *ngIf="form.get('departamento')?.invalid && form.get('departamento')?.touched">
          Enter a valid department
        </small>
      </div>

<!-- OFICINA -->
<div class="form-control">
  <label >Office</label>
  <select formControlName="oficina"
    [ngClass]="{ 'input-error': form.get('oficina')?.invalid && form.get('oficina')?.touched }">
    <option value="" disabled>Select an office</option>
    <option *ngFor="let o of (catalogs?.offices || [])" [value]="o?.name || o?.label || o?.title || o?.descripcion">{{ o?.name || o?.label || o?.title || o?.descripcion }}</option>
  </select>
  <small *ngIf="form.get('oficina')?.invalid && form.get('oficina')?.touched">
    Enter a valid office
  </small>
</div>

<!-- POSICI√ìN -->
<div class="form-control">
  <label >Position</label>
  <select formControlName="posicion"
    [ngClass]="{ 'input-error': form.get('posicion')?.invalid && form.get('posicion')?.touched }">
    <option value="" disabled>Select a position</option>
    <option *ngFor="let j of (catalogs?.jobs || [])" [value]="j?.name || j?.label || j?.title || j?.descripcion">{{ j?.name || j?.label || j?.title || j?.descripcion }}</option>
  </select>
  <small *ngIf="form.get('posicion')?.invalid && form.get('posicion')?.touched">
    Enter a valid position
  </small>
</div>

<!-- ROL -->
<div class="form-control">
  <label >Role</label>
  <select formControlName="rol"
    [ngClass]="{ 'input-error': form.get('rol')?.invalid && form.get('rol')?.touched }">
    <option value="" disabled>Select a role</option>
  <option *ngFor="let r of filteredAllowedRoles" [value]="r">{{ r }}</option>
  </select>
  <small *ngIf="form.get('rol')?.invalid && form.get('rol')?.touched">
    The role is required
  </small>
</div>

      <!-- FIN LISTAS -->

      <div class="form-control">
        <label >Billable Rate</label>
        <input type="number" placeholder="Billable Rate" formControlName="tarifa"
          [ngClass]="{ 'input-error': form.get('tarifa')?.invalid && form.get('tarifa')?.touched }">
        <small *ngIf="form.get('tarifa')?.invalid && form.get('tarifa')?.touched">
          Enter a valid rate
        </small>
      </div>
    </div>

    <!-- PASO 2 -->
    <div *ngIf="paso === 2" class="form-grid">
      <div>
        <label >Username</label>
        <input type="text" placeholder="Username" formControlName="usuario"
          [ngClass]="{ 'input-error': form.get('usuario')?.invalid && form.get('usuario')?.touched }">
        <small *ngIf="form.get('usuario')?.invalid && form.get('usuario')?.touched">This field is required</small>
      </div>

      <div class="form-control">
        <label >Email</label>
        <input type="email" placeholder="Email" formControlName="correo"
          [ngClass]="{ 'input-error': form.get('correo')?.invalid && form.get('correo')?.touched }">
        <small *ngIf="form.get('correo')?.invalid && form.get('correo')?.touched">
          Enter a valid email
        </small>
      </div>

      <div class="form-control password-group">
        <label>Password</label>
        <input [type]="showPassword ? 'text' : 'password'" placeholder="Password" formControlName="password"
          [ngClass]="{ 'input-error': form.get('password')?.invalid && form.get('password')?.touched }">
        <button type="button" class="toggle-password" (click)="showPassword = !showPassword" tabindex="-1">
          <span *ngIf="!showPassword">üëÅÔ∏è</span>
          <span *ngIf="showPassword"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
     xmlns="http://www.w3.org/2000/svg">
  <path d="M3 3L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  <path d="M17.94 17.94C16.07 19.22 14.12 20 12 20C7 20 3 14 3 14C4.12 12.17 5.5 10.63 7.06 9.46M9.9 7.6C10.57 7.21 11.28 7 12 7C17 7 21 13 21 13C20.56 13.73 20.06 14.39 19.52 15"
        stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  <circle cx="12" cy="14" r="2" fill="currentColor"/>
</svg>
</span>
        </button>
        <small *ngIf="form.get('password')?.invalid && form.get('password')?.touched">M√≠nimo 6 caracteres</small>
      </div>
    </div>

    <!-- BOTONES -->
    <div class="acciones">
      <button class="cancelar" (click)="cerrarModal()">Cancelar</button>
      <button class="atras" *ngIf="paso === 2" (click)="atras()">Atr√°s</button>
      <button class="siguiente" *ngIf="paso === 1" (click)="siguiente()">Siguiente</button>
      <button class="agregar" *ngIf="paso === 2" (click)="agregar()">Agregar</button>
        </div>
      </form>

    <!-- Modal de √©xito -->
    <div *ngIf="showSuccessModal" class="success-modal">
      <div style="font-size:2.5rem;color:#10b981;">‚úî</div>
      <span> Miembro creado correctamente</span>
    </div>

  

