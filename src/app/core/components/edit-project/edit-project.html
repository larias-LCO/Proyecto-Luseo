<!-- MODAL -->
<div class="modal show" id="teamModal">
  <div class="modal-card">

    <div class="modal-header">
      <h2 id="editTitle"> <app-edit-icon [size]="36"></app-edit-icon> Edit Project</h2>
       <app-x-icon class="close-button" (click)="onCancel()" [size]="35" [color]="'red'">
  <div class="close">Close</div>
 </app-x-icon>

    </div>


<div class="modal-body">

<form [formGroup]="form">
   <!-- GRID DE 3 COLUMNAS -->
      <div class="modal-grid">

    <div>
      <label>Code</label>
      <input type="text" class="input2" formControlName="projectCode">
    </div>

    <div>
      <label> ğŸ·ï¸ Name</label>
      <input type="text" formControlName="name">
    </div>

    <div>
      <label>ğŸ“ Area</label>
      <input type="number" formControlName="projectArea">
    </div>

    <div>
      <label>ğŸ”¢ Area Unit</label>
      <select formControlName="areaUnit">
        <option *ngFor="let unit of ['SQUARE_FEET','SQUARE_METER']" [value]="unit">
          {{ unit.replace('_',' ') }}
        </option>
      </select>
    </div>

    <div>
      <label>ğŸ—‚ï¸ Type</label>
      <select formControlName="projectType">
        <option *ngFor="let t of ['COMMERCIAL','RESIDENTIAL']" [value]="t">
          {{ t.replace('_',' ') }}
        </option>
      </select>
    </div>

    <div>
      <label>ğŸŸ¢ Status</label>
      <select formControlName="status">
        <option *ngFor="let s of ['IN_PROGRESS','COMPLETED','ON_HOLD']" [value]="s">
          {{ s.replace('_',' ') }}
        </option>
      </select>
    </div>

    <div>
      <label>ğŸ¯ Scope</label>
      <select formControlName="scope">
        <option *ngFor="let sc of ['NEW_BUILD','RENOVATION']" [value]="sc">
          {{ sc.replace('_',' ') }}
        </option>
      </select>
    </div>

    <div>
      <label>ğŸ¢ Office</label>
      <select formControlName="officeId">
        <option *ngFor="let o of offices" [value]="o.id">{{ o.name }}</option>
      </select>
    </div>

    <div>
      <label>ğŸ‘¥ Client</label>
      <select formControlName="clientId">
        <option *ngFor="let c of clients" [value]="c.id">{{ c.name }}</option>
      </select>
    </div>

    <div>
      <label>ğŸ’» Software</label>
      <select formControlName="softwareId">
        <option *ngFor="let s of software" [value]="s.id">{{ s.name }}</option>
      </select>
    </div>

    <div>
      <label for="p_phase">ğŸ”„ Project phase (optional)</label>
      <select id="p_phase" formControlName="phaseId">
        <option value="">None (no changes)</option>
        <ng-container *ngFor="let group of phaseGroups">
          <optgroup [label]="group.label">
            <option *ngFor="let ph of group.options" [value]="ph.value">{{ ph.label }}</option>
          </optgroup>
        </ng-container>
      </select>
    </div>
    <div *ngIf="showPhaseStatus">
      <label for="p_phaseStatus">Phase status</label>
      <select id="p_phaseStatus" formControlName="phaseStatus">
        <option value="">None</option>
        <option *ngFor="let s of phaseStatusOptions" [value]="s.value">{{ s.label }}</option>
      </select>
    </div>
    <div *ngIf="showPhaseStart">
      <label for="p_phaseStartDate">Phase start date (optional)</label>
      <input id="p_phaseStartDate" type="date" formControlName="phaseStartDate" />
    </div>
    <div *ngIf="showPhaseEnd">
      <label for="p_phaseEndDate">Phase end date (optional)</label>
      <input id="p_phaseEndDate" type="date" formControlName="phaseEndDate" />
    </div>

    <div style="grid-column: 1/-1;">
      <label>ğŸ“ Notes</label>
      <textarea formControlName="notes"></textarea>
    </div>

  <!-- TEAM ASSIGNMENT SECTION -->
  <div style="grid-column: 1 / -1;">
    <div class="section-title">
      <app-team-icon [size]="24"></app-team-icon> <span>Team Assignment</span>
      </div>
   

    <!-- CONTENEDOR 2 COLUMNAS: 50% Team, 50% PM -->
    <div class="two-column-grid">

      <!-- LEFT: TEAM -->
      <div class="filter-team">

        <label>ğŸ‘¥ Team</label>

        <div class="selected-box">
          <div *ngIf="teamSelectedEmployees.length; else noTeam">
            <div class="chip" *ngFor="let emp of teamSelectedEmployees">
              <span class="chip-avatar">{{ getInitials(emp.name) }}</span>
              <span class="chip-label">
                {{ emp.name }}
                <small class="chip-meta">Â· {{ emp.jobTitle }}{{ emp.department ? ' Â· '+emp.department : '' }}</small>
              </span>
              <button type="button" class="chip-remove" (click)="removeFromTeam(emp.id)">âœ•</button>
            </div>
          </div>
          <ng-template #noTeam>
            <div class="empty-note">No team members assigned yet.</div>
          </ng-template>
        </div>

        <div class="filters">
          <input [(ngModel)]="teamQuery" [ngModelOptions]="{standalone:true}" (input)="applyFilters()" placeholder="Search Name">
          <select [(ngModel)]="teamJob" [ngModelOptions]="{standalone:true}" (change)="applyFilters()">
            <option value="">Job position</option>
            <option *ngFor="let job of teamJobs" [value]="job.name">{{ job.name }}</option>
          </select>
          <select [(ngModel)]="teamDept" [ngModelOptions]="{standalone:true}" (change)="applyFilters()">
            <option value="">Department</option>
            <option *ngFor="let dept of teamDepartments" [value]="dept.name">{{ dept.name }}</option>
          </select>
        </div>

        <select multiple size="8" [(ngModel)]="teamSelection" [ngModelOptions]="{standalone:true}">
          <option *ngFor="let emp of teamFiltered" [ngValue]="emp.id"
            (mousedown)="$event.preventDefault(); toggleTeam(emp.id)">
            {{ (teamSelection.includes(emp.id)?'âœ” ':'') + emp.name + ' Â· ' + emp.jobTitle + (emp.department?' Â· '+emp.department:'') }}
          </option>
        </select>

      </div>

      <!-- RIGHT: ASSIGNED PM(s) -->
      <div class="filter-pm">

        <label>ğŸ‘¨â€ğŸ’¼ Assigned PM(s)</label>

        <div class="selected-box">
          <div *ngIf="pmSelectedEmployees.length; else noPM">
            <div class="chip" *ngFor="let emp of pmSelectedEmployees">
              <span class="chip-avatar">{{ getInitials(emp.name) }}</span>
              <span class="chip-label">
                {{ emp.name }}
                <small class="chip-meta">Â· {{ emp.jobTitle }}{{ emp.department ? ' Â· '+emp.department : '' }}</small>
              </span>
              <button type="button" class="chip-remove" (click)="removeFromPM(emp.id)">âœ•</button>
            </div>
          </div>
          <ng-template #noPM>
            <div class="empty-note">No PMs assigned yet.</div>
          </ng-template>
        </div>

        <div class="filters">
          <input [(ngModel)]="pmQuery" [ngModelOptions]="{standalone:true}" (input)="applyFilters()" placeholder="Search name (PM)">
        </div>

        <select multiple size="8" [(ngModel)]="pmSelection" [ngModelOptions]="{standalone:true}">
          <option *ngFor="let emp of pmFiltered" [ngValue]="emp.id"
            (mousedown)="$event.preventDefault(); togglePM(emp.id)">
            {{ (pmSelection.includes(emp.id)?'âœ” ':'') + emp.name + ' Â· ' + emp.jobTitle + (emp.department?' Â· '+emp.department:'') }}
          </option>
        </select>

      </div> <!-- end filter-pm -->

    </div> <!-- end two-column-grid -->
  </div> <!-- end team assignment section -->

</div> <!-- end modal-grid -->

</form>

</div> <!-- end modal-body -->


 <div class="modal-footer">
  <!-- ACTION BUTTONS -->
  <div class="actions" style="margin-top:18px; display:flex; gap:12px;">
    <!-- <button type="button" class="noselect" (click)="onCancel()"> -->
      <button class="noselect" (click)="onCancel()"><span class="text" >Cancel</span></button>
    

    <!-- <button type="button" class="btn btn-primary" (click)="onSave()">
      <span class="icon">ğŸ“</span> Save Changes</button> -->
 <div class="tooltip">
        <button type="button" class="action_has has_saved" aria-label="save" type="submit" (click)="onSave()">
            <svg
    aria-hidden="true"
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    stroke-linejoin="round"
    stroke-linecap="round"
    stroke-width="2"
    viewBox="0 0 24 24"
    stroke="currentColor"
    fill="none"
  >
    <path
      d="m19,21H5c-1.1,0-2-.9-2-2V5c0-1.1.9-2,2-2h11l5,5v11c0,1.1-.9,2-2,2Z"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="box"
    ></path>
    <path
      d="M7 3L7 8L15 8"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-top"
    ></path>
    <path
      d="M17 20L17 13L7 13L7 20"
      stroke-linejoin="round"
      stroke-linecap="round"
      data-path="line-bottom"
    ></path>
  </svg>
            </button>
            <span class="tooltip-text">Save Changes</span>
            </div>

  </div>
</div> <!-- end modal-footer -->

</div> <!-- end modal-card -->
</div> <!-- end modal -->

